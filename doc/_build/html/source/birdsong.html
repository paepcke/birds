

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>birdsong package &mdash; Birdsong  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Birdsong
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">birdsong package</a><ul>
<li><a class="reference internal" href="#subpackages">Subpackages</a></li>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-birdsong.birds_train_basic">birdsong.birds_train_basic module</a></li>
<li><a class="reference internal" href="#module-birdsong.birds_train_basic_CV">birdsong.birds_train_basic_CV module</a></li>
<li><a class="reference internal" href="#module-birdsong.birds_train_parallel">birdsong.birds_train_parallel module</a></li>
<li><a class="reference internal" href="#module-birdsong.class_weight_discovery">birdsong.class_weight_discovery module</a></li>
<li><a class="reference internal" href="#module-birdsong.conv_matrix">birdsong.conv_matrix module</a></li>
<li><a class="reference internal" href="#module-birdsong.cross_validation_dataloader">birdsong.cross_validation_dataloader module</a></li>
<li><a class="reference internal" href="#module-birdsong.display">birdsong.display module</a></li>
<li><a class="reference internal" href="#birdsong-distributed-c10d-module">birdsong.distributed_c10d module</a></li>
<li><a class="reference internal" href="#module-birdsong.ensembletrain">birdsong.ensembletrain module</a></li>
<li><a class="reference internal" href="#birdsong-launch-birds-training-module">birdsong.launch_birds_training module</a></li>
<li><a class="reference internal" href="#birdsong-launch-multiprocessing-training-runs-module">birdsong.launch_multiprocessing_training_runs module</a></li>
<li><a class="reference internal" href="#birdsong-launch-training-runs-module">birdsong.launch_training_runs module</a></li>
<li><a class="reference internal" href="#module-birdsong.nets">birdsong.nets module</a></li>
<li><a class="reference internal" href="#module-birdsong.result_tallying">birdsong.result_tallying module</a></li>
<li><a class="reference internal" href="#module-birdsong.rooted_image_dataset">birdsong.rooted_image_dataset module</a></li>
<li><a class="reference internal" href="#module-birdsong.run_inference">birdsong.run_inference module</a></li>
<li><a class="reference internal" href="#module-birdsong.samplers">birdsong.samplers module</a></li>
<li><a class="reference internal" href="#module-birdsong.trainingOrig">birdsong.trainingOrig module</a></li>
<li><a class="reference internal" href="#module-birdsong.xeno_canto_manager">birdsong.xeno_canto_manager module</a></li>
<li><a class="reference internal" href="#module-birdsong">Module contents</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Birdsong</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>birdsong package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/source/birdsong.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="birdsong-package">
<h1>birdsong package<a class="headerlink" href="#birdsong-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="birdsong.ml_plotting.html">birdsong.ml_plotting package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="birdsong.ml_plotting.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="birdsong.ml_plotting.tests.html">birdsong.ml_plotting.tests package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="birdsong.ml_plotting.tests.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.ml_plotting.tests.html#module-birdsong.ml_plotting.tests.test_classification_charts">birdsong.ml_plotting.tests.test_classification_charts module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.ml_plotting.tests.html#module-birdsong.ml_plotting.tests">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.ml_plotting.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.ml_plotting.html#module-birdsong.ml_plotting.classification_charts">birdsong.ml_plotting.classification_charts module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.ml_plotting.html#module-birdsong.ml_plotting">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="birdsong.tests.html">birdsong.tests package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="birdsong.tests.pytorch_distributed.html">birdsong.tests.pytorch_distributed package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="birdsong.tests.pytorch_distributed.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.tests.pytorch_distributed.html#module-birdsong.tests.pytorch_distributed.fake_train_script">birdsong.tests.pytorch_distributed.fake_train_script module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.tests.pytorch_distributed.html#module-birdsong.tests.pytorch_distributed.simple_multimachine_pytorch">birdsong.tests.pytorch_distributed.simple_multimachine_pytorch module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.tests.pytorch_distributed.html#module-birdsong.tests.pytorch_distributed">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.brokentest_birds_training_parallel_training">birdsong.tests.brokentest_birds_training_parallel_training module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.brokentest_birds_training_parallell_initialization">birdsong.tests.brokentest_birds_training_parallell_initialization module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.brokentest_train_results">birdsong.tests.brokentest_train_results module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_birds_training_basic_CV">birdsong.tests.test_birds_training_basic_CV module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_birds_training_parallel_save_model">birdsong.tests.test_birds_training_parallel_save_model module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_class_weight_discovery">birdsong.tests.test_class_weight_discovery module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_cross_validation_dataloader">birdsong.tests.test_cross_validation_dataloader module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#birdsong-tests-test-launch-birds-train-parallel-module">birdsong.tests.test_launch_birds_train_parallel module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#birdsong-tests-test-launch-training-runs-module">birdsong.tests.test_launch_training_runs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_model_archive">birdsong.tests.test_model_archive module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_multiprocess_sampler">birdsong.tests.test_multiprocess_sampler module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_nets">birdsong.tests.test_nets module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_rooted_image_dataloader">birdsong.tests.test_rooted_image_dataloader module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_rooted_image_dataset">birdsong.tests.test_rooted_image_dataset module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_run_inference">birdsong.tests.test_run_inference module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_single_process_sampler">birdsong.tests.test_single_process_sampler module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_tensorboard_ops">birdsong.tests.test_tensorboard_ops module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.test_xeno_canto_manager">birdsong.tests.test_xeno_canto_manager module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests.zzzDeleteMeSomeDay_training">birdsong.tests.zzzDeleteMeSomeDay_training module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.tests.html#module-birdsong.tests">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="birdsong.utils.html">birdsong.utils package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="birdsong.utils.tests.html">birdsong.utils.tests package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_dottable_config_parser">birdsong.utils.tests.test_dottable_config_parser module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_dottable_map">birdsong.utils.tests.test_dottable_map module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_match_snippets_to_selection_table">birdsong.utils.tests.test_match_snippets_to_selection_table module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_move_random_perc_of_files">birdsong.utils.tests.test_move_random_perc_of_files module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_multiclass_pr_curve">birdsong.utils.tests.test_multiclass_pr_curve module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_neural_net_config">birdsong.utils.tests.test_neural_net_config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_tensorboard_manager">birdsong.utils.tests.test_tensorboard_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_tensorboard_plotter">birdsong.utils.tests.test_tensorboard_plotter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests.test_utilities">birdsong.utils.tests.test_utilities module</a></li>
<li class="toctree-l4"><a class="reference internal" href="birdsong.utils.tests.html#module-birdsong.utils.tests">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.dottable_config">birdsong.utils.dottable_config module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.dottable_map">birdsong.utils.dottable_map module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.github_table_maker">birdsong.utils.github_table_maker module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.learning_phase">birdsong.utils.learning_phase module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.match_snippets_to_selection_table">birdsong.utils.match_snippets_to_selection_table module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.minimal_across_two_gpus_ddp">birdsong.utils.minimal_across_two_gpus_ddp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.minimal_ddp_launcher">birdsong.utils.minimal_ddp_launcher module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.minimal_within_two_gpus_ddp">birdsong.utils.minimal_within_two_gpus_ddp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.model_archive">birdsong.utils.model_archive module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.move_random_perc_of_files">birdsong.utils.move_random_perc_of_files module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#birdsong-utils-multi-class-pr-curves-module">birdsong.utils.multi_class_pr_curves module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.neural_net_config">birdsong.utils.neural_net_config module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.remove_bad_bird_recordings">birdsong.utils.remove_bad_bird_recordings module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.tensorboard_manager">birdsong.utils.tensorboard_manager module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.tensorboard_plotter">birdsong.utils.tensorboard_plotter module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.tiny_one_gpu_ddp">birdsong.utils.tiny_one_gpu_ddp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.tiny_one_gpu_no_ddp">birdsong.utils.tiny_one_gpu_no_ddp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.trash">birdsong.utils.trash module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.utilities">birdsong.utils.utilities module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils.xeno_canto_download_cleaning">birdsong.utils.xeno_canto_download_cleaning module</a></li>
<li class="toctree-l2"><a class="reference internal" href="birdsong.utils.html#module-birdsong.utils">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-birdsong.birds_train_basic">
<span id="birdsong-birds-train-basic-module"></span><h2>birdsong.birds_train_basic module<a class="headerlink" href="#module-birdsong.birds_train_basic" title="Permalink to this headline">¶</a></h2>
<p>Created on Mar 2, 2021</p>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.birds_train_basic.</span></span><span class="sig-name descname"><span class="pre">BirdsTrainBasic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debugging</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>classdocs</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.DISPLAY_HISTORY_LEN">
<span class="sig-name descname"><span class="pre">DISPLAY_HISTORY_LEN</span></span><em class="property"> <span class="pre">=</span> <span class="pre">10</span></em><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.DISPLAY_HISTORY_LEN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.MODEL_ARCHIVE_SIZE">
<span class="sig-name descname"><span class="pre">MODEL_ARCHIVE_SIZE</span></span><em class="property"> <span class="pre">=</span> <span class="pre">20</span></em><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.MODEL_ARCHIVE_SIZE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.close_tensorboard">
<span class="sig-name descname"><span class="pre">close_tensorboard</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.close_tensorboard" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.create_csv_writer">
<span class="sig-name descname"><span class="pre">create_csv_writer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_data_dir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.create_csv_writer" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a csv_writer that will fill a csv
file during training/validation as follows:</p>
<blockquote>
<div><p>epoch  train_preds   train_labels  val_preds  val_labels</p>
</div></blockquote>
<p>Cols after the integer ‘epoch’ col will each be
an array of ints:</p>
<blockquote>
<div><blockquote>
<div><p>train_preds    train_lbls   val_preds  val_lbls</p>
</div></blockquote>
<p>2,”[2,5,1,2,3]”,”[2,6,1,2,1]”,”[1,2]”,    “[1,3]”</p>
</div></blockquote>
<p>If raw_data_dir is provided as a str, it is
taken as the directory where csv file with predictions
and labels are to be written. The dir is created if necessary.</p>
<p>If the arg is instead set to True, a dir ‘runs_raw_results’ is
created under this script’s directory if it does not
exist. Then a subdirectory is created for this run,
using the hparam settings to build a file name. The dir
is created if needed. Result ex.:</p>
<blockquote>
<div><dl class="simple">
<dt>&lt;script_dir&gt;</dt><dd><dl class="simple">
<dt>runs_raw_results</dt><dd><dl class="simple">
<dt>Run_lr_0.001_br_32</dt><dd><p><a href="#id3"><span class="problematic" id="id4">run_2021_05_</span></a> … _lr_0.001_br_32.csv</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>Then file name is created, again from the run
hparam settings. If this file exists, user is asked whether
to remove or append. The inst var self.csv_writer is
initialized to:</p>
<blockquote>
<div><dl class="simple">
<dt>o None if csv file exists, but is not to </dt><dd><p>be overwritten nor appended-to</p>
</dd>
<dt>o A filed descriptor for a file open for either</dt><dd><p>‘write’ or ‘append.</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>raw_data_dir</strong> (<em>{None | True | str|</em>) – If simply True, create dir and file names
from hparams, and create as needed. If a string, it is 
assumed to be the directory where a .csv file is to be
created. If None, self.csv_writer is set to None.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>CSV writer ready for action. Set either to
write a fresh file, or append to an existing file.
Unless file exists, and user decided not to overwrite</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>{None | csv.writer}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.create_model_archive">
<span class="sig-name descname"><span class="pre">create_model_archive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_classes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.create_model_archive" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates facility for saving partially trained
models along the way.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – </p></li>
<li><p><strong>num_classes</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ModelArchive instance ready
for calls to save_model()</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="birdsong.utils.html#birdsong.utils.model_archive.ModelArchive" title="birdsong.utils.model_archive.ModelArchive">ModelArchive</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.find_num_classes">
<span class="sig-name descname"><span class="pre">find_num_classes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_root</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.find_num_classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Expect two subdirectories under data_root:
train and validation. Underneath each are 
further subdirectories whose names are the
classes:</p>
<blockquote>
<div><p>train               validation</p>
</div></blockquote>
<dl class="simple">
<dt>class1 class2 class3     class1 class2 class3</dt><dd><p>imgs   imgs   imgs       imgs   imgs   imgs</p>
</dd>
</dl>
<p>No error checking to confirm this structure</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data_root</strong> (<em>str</em>) – path to parent of train/validation</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>number of unique classes as obtained
from the directory names</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.get_dataloader">
<span class="sig-name descname"><span class="pre">get_dataloader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_height</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.get_dataloader" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a train and a validate dataloader</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.get_optimizer">
<span class="sig-name descname"><span class="pre">get_optimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.get_optimizer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.initialize_config_struct">
<span class="sig-name descname"><span class="pre">initialize_config_struct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.initialize_config_struct" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a config dict of dict with
the application’s configurations. Sections
will be:</p>
<blockquote>
<div><p>config[‘Paths’]       -&gt; dict[attr : val]
config[‘Training’]    -&gt; dict[attr : val]
config[‘Parallelism’] -&gt; dict[attr : val]</p>
</div></blockquote>
<p>The config read method will handle config_info
being None.</p>
<p>If config_info is a string, it is assumed either 
to be a file containing the configuration, or
a JSON string that defines the config.</p>
<p>Else config_info is assumed to be a NeuralNetConfig.
The latter is relevant only if using this file
as a library, rather than a command line tool.</p>
<p>If given a NeuralNetConfig instance, it is returned
unchanged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config_info</strong> (<em>{NeuralNetConfig | str}</em>) – the information needed to construct
the structure</p>
</dd>
</dl>
<dl class="simple">
<dt>:return a NeuralNetConfig instance with all parms</dt><dd><p>initialized</p>
</dd>
</dl>
<p>:rtype NeuralNetConfig</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.read_configuration">
<span class="sig-name descname"><span class="pre">read_configuration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conf_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.read_configuration" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses config file that describes training parameters,
various file paths, and how many GPUs different machines have.
Syntax follows Python’s configfile package, which includes
sections, and attr/val pairs in each section.</p>
<p>Expected sections:</p>
<blockquote>
<div><p>o Paths: various file paths for the application
o Training: holds batch sizes, number of epochs, etc.
o Parallelism: holds number of GPUs on different machines</p>
</div></blockquote>
<p>For Parallelism, expect entries like:</p>
<blockquote>
<div><p>foo.bar.com  = 4
127.0.0.1    = 5
localhost    = 3
172.12.145.1 = 6</p>
</div></blockquote>
<p>Method identifies which of the entries is
‘localhost’ by comparing against local hostname.
Though ‘localhost’ or ‘127.0.0.1’ may be provided.</p>
<dl class="simple">
<dt>Returns a dict of dicts: </dt><dd><p>config[section-names][attr-names-within-section]</p>
</dd>
</dl>
<p>Types of standard entries, such as epochs, batch_size,
etc. are coerced, so that, e.g. config[‘Training’][‘epochs’]
will be an int. Clients may add non-standard entries.
For those the client must convert values from string
(the type in which values are stored by default) to the
required type. This can be done the usual way: int(…),
or using one of the configparser’s retrieval methods
getboolean(), getint(), and getfloat():</p>
<blockquote>
<div><p>config[‘Training’].getfloat(‘learning_rate’)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other_gpu_config_file</strong> (<em>str</em>) – path to configuration file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a dict of dicts mirroring the config file sections/entries</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict[dict]</p>
</dd>
</dl>
<p>:raises ValueErr
:raises TypeError</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.remember_results">
<span class="sig-name descname"><span class="pre">remember_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.remember_results" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.report_acc_loss">
<span class="sig-name descname"><span class="pre">report_acc_loss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accumulated_loss</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.report_acc_loss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.report_hparams_summary">
<span class="sig-name descname"><span class="pre">report_hparams_summary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">latest_result</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.report_hparams_summary" title="Permalink to this definition">¶</a></dt>
<dd><p>Called at the end of training. Constructs
a summary to report for the hyperparameters
used in this process. Reports to the tensorboard.</p>
<p>Hyperparameters reported:</p>
<blockquote>
<div><p>o lr
o optimizer
o batch_size
o kernel_size</p>
</div></blockquote>
<p>Included in the measures are:</p>
<blockquote>
<div><p>o balanced_accuracy      (train and val)
o mean_accuracy_train    (train and val)
o epoch_prec_weighted
o epoch_recall_weighted
o epoch_mean_loss        (train and val)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>latest_result</strong> (<em>{'train' : ResultTally</em><em>,
</em><em>'val'   : ResultTally
}</em>) – dict with keys ‘train’ and
‘val’, holding the respective most recent
(i.e. last-epoch) ResultTally</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.set_seed">
<span class="sig-name descname"><span class="pre">set_seed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.set_seed" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the seed across all different necessary platforms
to allow for comparison of different models and runs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>seed</strong> (<em>int</em>) – random seed to set for all random num generators</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.setup_tensorboard">
<span class="sig-name descname"><span class="pre">setup_tensorboard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw_data_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.setup_tensorboard" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize tensorboard. To easily compare experiments,
use runs/exp1, runs/exp2, etc.</p>
<p>Method creates the dir if needed.</p>
<p>Additionally, sets self.csv_pred_writer and self.csv_label_writer
to None, or open CSV writers, depending on the value of raw_data_dir,
see create_csv_writer()</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>logdir</strong> (<em>str</em>) – root for tensorboard events</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.time_delta_str">
<span class="sig-name descname"><span class="pre">time_delta_str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch_delta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">granularity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.time_delta_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the difference between two datetime times:</p>
<blockquote>
<div><p>start_time = datetime.datetime.now()
&lt;some time elapses&gt;
end_time = datetime.datetime.now()</p>
<p>delta = end_time - start_time
time_delta_str(delta</p>
</div></blockquote>
<p>Depending on granularity, returns a string like:</p>
<blockquote>
<div><dl class="simple">
<dt>Granularity:</dt><dd><p>1  ‘160.0 weeks’
2  ‘160.0 weeks, 4.0 days’
3  ‘160.0 weeks, 4.0 days, 6.0 hours’
4  ‘160.0 weeks, 4.0 days, 6.0 hours, 42.0 minutes’
5  ‘160.0 weeks, 4.0 days, 6.0 hours, 42.0 minutes, 13.0 seconds’</p>
</dd>
</dl>
<p>For smaller time deltas, such as 10 seconds,
does not include leading zero times. For
any granularity:</p>
<blockquote>
<div><p>‘10.0 seconds’</p>
</div></blockquote>
<p>If duration is less than second, returns ‘&lt; 1sec&gt;’</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>epoch_delta</strong> – </p></li>
<li><p><strong>granularity</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.train" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.visualize_final_epoch_results">
<span class="sig-name descname"><span class="pre">visualize_final_epoch_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.visualize_final_epoch_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Reports to tensorboard just for the
final epoch.</p>
<p>Expect self.latest_result to be the latest
ResultTally.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic.BirdsTrainBasic.visualize_step">
<span class="sig-name descname"><span class="pre">visualize_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic.BirdsTrainBasic.visualize_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Take the ResultTally instances
in the train and val ResultCollections
in self.results, and report appropriate
aggregates to tensorboard. Computes
f1 scores, accuracies, etc. for given
step.</p>
<p>Separately for train and validation
results: build one long array 
of predictions, and a corresponding
array of labels. Also, average the
loss across all instances.</p>
<p>The the preds and labels as rows to csv 
files.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.birds_train_basic_CV">
<span id="birdsong-birds-train-basic-cv-module"></span><h2>birdsong.birds_train_basic_CV module<a class="headerlink" href="#module-birdsong.birds_train_basic_CV" title="Permalink to this headline">¶</a></h2>
<p>Created on Mar 2, 2021</p>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.birds_train_basic_CV.</span></span><span class="sig-name descname"><span class="pre">BirdsBasicTrainerCV</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debugging</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>classdocs</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.DISPLAY_HISTORY_LEN">
<span class="sig-name descname"><span class="pre">DISPLAY_HISTORY_LEN</span></span><em class="property"> <span class="pre">=</span> <span class="pre">10</span></em><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.DISPLAY_HISTORY_LEN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.MODEL_ARCHIVE_SIZE">
<span class="sig-name descname"><span class="pre">MODEL_ARCHIVE_SIZE</span></span><em class="property"> <span class="pre">=</span> <span class="pre">20</span></em><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.MODEL_ARCHIVE_SIZE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.cleanup">
<span class="sig-name descname"><span class="pre">cleanup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Recover resources taken by collaborating
processes. OK to call multiple times.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.close_tensorboard">
<span class="sig-name descname"><span class="pre">close_tensorboard</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.close_tensorboard" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.create_csv_writer">
<span class="sig-name descname"><span class="pre">create_csv_writer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_data_dir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.create_csv_writer" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a csv_writer that will fill a csv
file during training/validation as follows:</p>
<blockquote>
<div><p>epoch  train_preds   train_labels  val_preds  val_labels</p>
</div></blockquote>
<p>Cols after the integer ‘epoch’ col will each be
an array of ints:</p>
<blockquote>
<div><blockquote>
<div><p>train_preds    train_lbls   val_preds  val_lbls</p>
</div></blockquote>
<p>2,”[2,5,1,2,3]”,”[2,6,1,2,1]”,”[1,2]”,    “[1,3]”</p>
</div></blockquote>
<p>If raw_data_dir is provided as a str, it is
taken as the directory where csv file with predictions
and labels are to be written. The dir is created if necessary.</p>
<p>If the arg is instead set to True, a dir ‘runs_raw_results’ is
created under this script’s directory if it does not
exist. Then a subdirectory is created for this run,
using the hparam settings to build a file name. The dir
is created if needed. Result ex.:</p>
<blockquote>
<div><dl class="simple">
<dt>&lt;script_dir&gt;</dt><dd><dl class="simple">
<dt>runs_raw_results</dt><dd><dl class="simple">
<dt>Run_lr_0.001_br_32</dt><dd><p><a href="#id5"><span class="problematic" id="id6">run_2021_05_</span></a> … _lr_0.001_br_32.csv</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>Then file name is created, again from the run
hparam settings. If this file exists, user is asked whether
to remove or append. The inst var self.csv_writer is
initialized to:</p>
<blockquote>
<div><dl class="simple">
<dt>o None if csv file exists, but is not to </dt><dd><p>be overwritten nor appended-to</p>
</dd>
<dt>o A filed descriptor for a file open for either</dt><dd><p>‘write’ or ‘append.</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>raw_data_dir</strong> (<em>{None | True | str|</em>) – If simply True, create dir and file names
from hparams, and create as needed. If a string, it is 
assumed to be the directory where a .csv file is to be
created. If None, self.csv_writer is set to None.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>CSV writer ready for action. Set either to
write a fresh file, or append to an existing file.
Unless file exists, and user decided not to overwrite</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>{None | csv.writer}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.create_model_archive">
<span class="sig-name descname"><span class="pre">create_model_archive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_classes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.create_model_archive" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates facility for saving partially trained
models along the way.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – </p></li>
<li><p><strong>num_classes</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ModelArchive instance ready
for calls to save_model()</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="birdsong.utils.html#birdsong.utils.model_archive.ModelArchive" title="birdsong.utils.model_archive.ModelArchive">ModelArchive</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.find_num_classes">
<span class="sig-name descname"><span class="pre">find_num_classes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_root</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.find_num_classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Expect two subdirectories under data_root:
train and validation. Underneath each are 
further subdirectories whose names are the
classes:</p>
<blockquote>
<div><p>train               validation</p>
</div></blockquote>
<dl class="simple">
<dt>class1 class2 class3     class1 class2 class3</dt><dd><p>imgs   imgs   imgs       imgs   imgs   imgs</p>
</dd>
</dl>
<p>No error checking to confirm this structure</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data_root</strong> (<em>str</em>) – path to parent of train/validation</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>number of unique classes as obtained
from the directory names</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.get_dataloader">
<span class="sig-name descname"><span class="pre">get_dataloader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perc_data_to_use</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.get_dataloader" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a cross validating dataloader. 
If perc_data_to_use is None, all samples
under self.root_train_test_data will be
used for training. Else percentage indicates
the percentage of those samples to use. The
selection is random.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sample_width</strong> (<em>int</em>) – pixel width of returned images</p></li>
<li><p><strong>sample_height</strong> (<em>int</em>) – pixel height of returned images</p></li>
<li><p><strong>perc_data_to_use</strong> (<em>{None | int | float}</em>) – amount of available training
data to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a data loader that serves batches of
images and their assiated labels</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader" title="birdsong.cross_validation_dataloader.CrossValidatingDataLoader">CrossValidatingDataLoader</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.get_optimizer">
<span class="sig-name descname"><span class="pre">get_optimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.get_optimizer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.initialize_config_struct">
<span class="sig-name descname"><span class="pre">initialize_config_struct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.initialize_config_struct" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a config dict of dict with
the application’s configurations. Sections
will be:</p>
<blockquote>
<div><p>config[‘Paths’]       -&gt; dict[attr : val]
config[‘Training’]    -&gt; dict[attr : val]
config[‘Parallelism’] -&gt; dict[attr : val]</p>
</div></blockquote>
<p>The config read method will handle config_info
being None.</p>
<p>If config_info is a string, it is assumed either 
to be a file containing the configuration, or
a JSON string that defines the config.</p>
<p>Else config_info is assumed to be a NeuralNetConfig.
The latter is relevant only if using this file
as a library, rather than a command line tool.</p>
<p>If given a NeuralNetConfig instance, it is returned
unchanged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config_info</strong> (<em>{NeuralNetConfig | str}</em>) – the information needed to construct
the structure</p>
</dd>
</dl>
<dl class="simple">
<dt>:return a NeuralNetConfig instance with all parms</dt><dd><p>initialized</p>
</dd>
</dl>
<p>:rtype NeuralNetConfig</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.initialize_model">
<span class="sig-name descname"><span class="pre">initialize_model</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.initialize_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.read_configuration">
<span class="sig-name descname"><span class="pre">read_configuration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conf_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.read_configuration" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses config file that describes training parameters,
various file paths, and how many GPUs different machines have.
Syntax follows Python’s configfile package, which includes
sections, and attr/val pairs in each section.</p>
<p>Expected sections:</p>
<blockquote>
<div><p>o Paths: various file paths for the application
o Training: holds batch sizes, number of epochs, etc.
o Parallelism: holds number of GPUs on different machines</p>
</div></blockquote>
<p>For Parallelism, expect entries like:</p>
<blockquote>
<div><p>foo.bar.com  = 4
127.0.0.1    = 5
localhost    = 3
172.12.145.1 = 6</p>
</div></blockquote>
<p>Method identifies which of the entries is
‘localhost’ by comparing against local hostname.
Though ‘localhost’ or ‘127.0.0.1’ may be provided.</p>
<dl class="simple">
<dt>Returns a dict of dicts: </dt><dd><p>config[section-names][attr-names-within-section]</p>
</dd>
</dl>
<p>Types of standard entries, such as epochs, batch_size,
etc. are coerced, so that, e.g. config[‘Training’][‘epochs’]
will be an int. Clients may add non-standard entries.
For those the client must convert values from string
(the type in which values are stored by default) to the
required type. This can be done the usual way: int(…),
or using one of the configparser’s retrieval methods
getboolean(), getint(), and getfloat():</p>
<blockquote>
<div><p>config[‘Training’].getfloat(‘learning_rate’)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other_gpu_config_file</strong> (<em>str</em>) – path to configuration file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a dict of dicts mirroring the config file sections/entries</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict[dict]</p>
</dd>
</dl>
<p>:raises ValueErr
:raises TypeError</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.remember_results">
<span class="sig-name descname"><span class="pre">remember_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.remember_results" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.report_acc_loss">
<span class="sig-name descname"><span class="pre">report_acc_loss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accumulated_loss</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.report_acc_loss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.report_hparams_summary">
<span class="sig-name descname"><span class="pre">report_hparams_summary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">latest_result</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.report_hparams_summary" title="Permalink to this definition">¶</a></dt>
<dd><p>Called at the end of training. Constructs
a summary to report for the hyperparameters
used in this process. Reports to the tensorboard.</p>
<p>Hyperparameters reported:</p>
<blockquote>
<div><p>o lr
o optimizer
o batch_size
o kernel_size</p>
</div></blockquote>
<p>Included in the measures are:</p>
<blockquote>
<div><p>o balanced_accuracy      (train and val)
o mean_accuracy_train    (train and val)
o epoch_prec_weighted
o epoch_recall_weighted
o epoch_mean_loss        (train and val)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>latest_result</strong> (<em>{'train' : ResultTally</em><em>,
</em><em>'val'   : ResultTally
}</em>) – dict with keys ‘train’ and
‘val’, holding the respective most recent
(i.e. last-epoch) ResultTally</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.set_seed">
<span class="sig-name descname"><span class="pre">set_seed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.set_seed" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the seed across all different necessary platforms
to allow for comparison of different models and runs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>seed</strong> (<em>int</em>) – random seed to set for all random num generators</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.setup_tensorboard">
<span class="sig-name descname"><span class="pre">setup_tensorboard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw_data_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.setup_tensorboard" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize tensorboard. To easily compare experiments,
use runs/exp1, runs/exp2, etc.</p>
<p>Method creates the dir if needed.</p>
<p>Additionally, sets self.csv_pred_writer and self.csv_label_writer
to None, or open CSV writers, depending on the value of raw_data_dir,
see create_csv_writer()</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>logdir</strong> (<em>str</em>) – root for tensorboard events</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.step_number">
<span class="sig-name descname"><span class="pre">step_number</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">split_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_folds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.step_number" title="Permalink to this definition">¶</a></dt>
<dd><p>Combines an epoch with a split number into 
a single integer series as epochs increase,
and split_num cycles from 0 to num_folds.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>epoch</strong> (<em>int</em>) – epoch to encode</p></li>
<li><p><strong>split_num</strong> (<em>int</em>) – split number to encode</p></li>
<li><p><strong>num_folds</strong> (<em>int</em>) – number of folds for CV splitting
must be contant!</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>an integer the combines epoch and split-num</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.time_delta_str">
<span class="sig-name descname"><span class="pre">time_delta_str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch_delta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">granularity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.time_delta_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the difference between two datetime times:</p>
<blockquote>
<div><p>start_time = datetime.datetime.now()
&lt;some time elapses&gt;
end_time = datetime.datetime.now()</p>
<p>delta = end_time - start_time
time_delta_str(delta</p>
</div></blockquote>
<p>Depending on granularity, returns a string like:</p>
<blockquote>
<div><dl class="simple">
<dt>Granularity:</dt><dd><p>1  ‘160.0 weeks’
2  ‘160.0 weeks, 4.0 days’
3  ‘160.0 weeks, 4.0 days, 6.0 hours’
4  ‘160.0 weeks, 4.0 days, 6.0 hours, 42.0 minutes’
5  ‘160.0 weeks, 4.0 days, 6.0 hours, 42.0 minutes, 13.0 seconds’</p>
</dd>
</dl>
<p>For smaller time deltas, such as 10 seconds,
does not include leading zero times. For
any granularity:</p>
<blockquote>
<div><p>‘10.0 seconds’</p>
</div></blockquote>
<p>If duration is less than second, returns ‘&lt; 1sec&gt;’</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>epoch_delta</strong> – </p></li>
<li><p><strong>granularity</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.train" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.validate_split">
<span class="sig-name descname"><span class="pre">validate_split</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.validate_split" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate one split, using that split’s 
validation fold. Return time taken. Record
results for tensorboard and other record keeping.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>step</strong> (<em>int</em>) – current combination of epoch and 
split</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>number of epoch seconds needed for the validation</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.visualize_final_epoch_results">
<span class="sig-name descname"><span class="pre">visualize_final_epoch_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.visualize_final_epoch_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Reports to tensorboard just for the
final epoch.</p>
<p>Expect self.latest_result to be the latest
ResultTally.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.visualize_step">
<span class="sig-name descname"><span class="pre">visualize_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.BirdsBasicTrainerCV.visualize_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Take the ResultTally instances
in the train and val ResultCollections
in self.results, and report appropriate
aggregates to tensorboard. Computes
f1 scores, accuracies, etc. for given
step.</p>
<p>Separately for train and validation
results: build one long array 
of predictions, and a corresponding
array of labels. Also, average the
loss across all instances.</p>
<p>The preds and labels as rows to csv 
files.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="birdsong.birds_train_basic_CV.unsqueeze">
<span class="sig-prename descclassname"><span class="pre">birdsong.birds_train_basic_CV.</span></span><span class="sig-name descname"><span class="pre">unsqueeze</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Tensor</span><a class="headerlink" href="#birdsong.birds_train_basic_CV.unsqueeze" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new tensor with a dimension of size one inserted at the
specified position.</p>
<p>The returned tensor shares the same underlying data with this tensor.</p>
<p>A <code class="xref py py-attr docutils literal notranslate"><span class="pre">dim</span></code> value within the range <code class="docutils literal notranslate"><span class="pre">[-input.dim()</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">input.dim()</span> <span class="pre">+</span> <span class="pre">1)</span></code>
can be used. Negative <code class="xref py py-attr docutils literal notranslate"><span class="pre">dim</span></code> will correspond to <a class="reference internal" href="#birdsong.birds_train_basic_CV.unsqueeze" title="birdsong.birds_train_basic_CV.unsqueeze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unsqueeze()</span></code></a>
applied at <code class="xref py py-attr docutils literal notranslate"><span class="pre">dim</span></code> = <code class="docutils literal notranslate"><span class="pre">dim</span> <span class="pre">+</span> <span class="pre">input.dim()</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>input (Tensor): the input tensor.
dim (int): the index at which to insert the singleton dimension</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">tensor([[ 1,  2,  3,  4]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">tensor([[ 1],</span>
<span class="go">        [ 2],</span>
<span class="go">        [ 3],</span>
<span class="go">        [ 4]])</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-birdsong.birds_train_parallel">
<span id="birdsong-birds-train-parallel-module"></span><h2>birdsong.birds_train_parallel module<a class="headerlink" href="#module-birdsong.birds_train_parallel" title="Permalink to this headline">¶</a></h2>
<p>Created on Jul 7, 2020 based heavily on
code by</p>
<blockquote>
<div><p>o Jonathan Michael Gomes Selman,
o Nikita-Girey Nechvet Demir, 
o Leo Epstein Glikbarg
o Amy C Dunphy</p>
</div></blockquote>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.birds_train_parallel.</span></span><span class="sig-name descname"><span class="pre">BirdTrainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">root_train_test_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkpoint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logging_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">performance_log_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">testing_cuda_on_cpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">comm_info</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit_testing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.EPOCHS_FOR_PLATEAU_DETECTION">
<span class="sig-name descname"><span class="pre">EPOCHS_FOR_PLATEAU_DETECTION</span></span><em class="property"> <span class="pre">=</span> <span class="pre">5</span></em><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.EPOCHS_FOR_PLATEAU_DETECTION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.SECS_IN_DAY">
<span class="sig-name descname"><span class="pre">SECS_IN_DAY</span></span><em class="property"> <span class="pre">=</span> <span class="pre">86400</span></em><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.SECS_IN_DAY" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.SHUTDOWN_WAIT">
<span class="sig-name descname"><span class="pre">SHUTDOWN_WAIT</span></span><em class="property"> <span class="pre">=</span> <span class="pre">3</span></em><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.SHUTDOWN_WAIT" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.STOP">
<span class="sig-name descname"><span class="pre">STOP</span></span><em class="property"> <span class="pre">=</span> <span class="pre">False</span></em><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.STOP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.available_optimizers">
<span class="sig-name descname"><span class="pre">available_optimizers</span></span><em class="property"> <span class="pre">=</span> <span class="pre">['Adam',</span> <span class="pre">'RMSprop',</span> <span class="pre">'SGD']</span></em><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.available_optimizers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.cleanup">
<span class="sig-name descname"><span class="pre">cleanup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Recover resources taken by collaborating
processes. OK to call multiple times.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.clear_gpu">
<span class="sig-name descname"><span class="pre">clear_gpu</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.clear_gpu" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all of this process’s data
from the GPU(s)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.device_residence">
<span class="sig-name descname"><span class="pre">device_residence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.device_residence" title="Permalink to this definition">¶</a></dt>
<dd><p>Terrible hack to get around pytorch models
not having a device() method that returns which
device they are on.</p>
<dl class="simple">
<dt>NOTE: Works only if model parameters are not</dt><dd><p>spread across multiple GPUs</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>model</strong> (<em>torchvision.models</em>) – any pytorch model</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.enable_GPU">
<span class="sig-name descname"><span class="pre">enable_GPU</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_rank</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_gpu_unavailable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.enable_GPU" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the device_residence id (an int) of an 
available GPU. If none is exists on this 
machine, returns device(‘cpu’)</p>
<p>Initializes self.gpu_obj, which is a CUDA
GPU instance.</p>
<p>Initializes self.cuda_dev: f”cuda:{device_id}”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>local_rank</strong> (<em>{None|int|</em>) – which GPU to use. Created by the launch.py
script. If None, just look for the next available GPU</p></li>
<li><p><strong>raise_gpu_unavailable</strong> (<em>bool</em>) – whether to raise error
when GPUs exist on this machine, but none are available.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a GPU device_residence ID, or device(‘cpu’)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="#birdsong.birds_train_parallel.NoGPUAvailable" title="birdsong.birds_train_parallel.NoGPUAvailable"><strong>NoGPUAvailable</strong></a> – if exception requested via 
raise_gpu_unavailable, and no GPU is available.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.find_available_torch_backend">
<span class="sig-name descname"><span class="pre">find_available_torch_backend</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.find_available_torch_backend" title="Permalink to this definition">¶</a></dt>
<dd><p>For parallel operation, torch needs a backend
compiled into the torch package binaries. Options
are nccl, mpi, and gloo. Return a string with
the name of one of the backend names. If none are 
available, raise NotImplementedError</p>
<p>:return Name of torch backend
:rtype: str
:raise NotImplementedError</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.find_log_path">
<span class="sig-name descname"><span class="pre">find_log_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.find_log_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a log file, which may be None, 
find a destinating for info/err messages.
In all cases, specify a msg_identifier for
LoggingService to prepend to messages. The
id specifies this node’s rank to distinquish
msg from those of other nodes.</p>
<blockquote>
<div><dl class="simple">
<dt>o logfile is None, check in config. </dt><dd><p>If nothing found, log to stdout.</p>
</dd>
<dt>o if given logfile is a directory, a</dt><dd><p>filename is constructed inside that dir.
The name will contain this node’s rank</p>
</dd>
<dt>o if file name is given, it is augmented </dt><dd><p>with this node’s rank.</p>
</dd>
</dl>
</div></blockquote>
<p>Assumptions: self.rank contains this node’s rank</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>logfile</strong> (<em>{None | str}</em>) – specification for the log file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a ready-to-use LoggingService instance</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>LoggingService</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.get_class_support">
<span class="sig-name descname"><span class="pre">get_class_support</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.get_class_support" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the distribution of samples
in the underlying dataset by class</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of tuples: (class_id, num_samples);
one such tuple for each class_id</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>[(int, int)]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.get_lr">
<span class="sig-name descname"><span class="pre">get_lr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scheduler</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.get_lr" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a scheduler instance, return its
current learning rate. All schedulers but
one have a get_lr() method themselves. But
the auto-lr-reducing ReduceLROnPlateau does
not. It maintains multiple learning rates,
one for each ‘group’. So the result of a
get_lr() method would be a list, which would
be contrary to all other schedulers. This
method masks the difference.</p>
<p>We only have one group, so we return the
first (and only) lr if the scheduler is an
instance of the problem class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>scheduler</strong> – scheduler whose learning rate 
is to be retrieved</p>
</dd>
</dl>
<p>:type scheduler:torch.optim.lr_scheduler
:return: the scheduler’s current learning rate
:rtype: float</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.get_prec_rec_components">
<span class="sig-name descname"><span class="pre">get_prec_rec_components</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pred_tns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_tns</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.get_prec_rec_components" title="Permalink to this definition">¶</a></dt>
<dd><p>Given tensor of finalized predictions (0s and 1s),
and the label tensor from the dataloader, return
numbers of true positive, the sum of true positive
and false positive, and the sum of true positive,
and false negatives (tp, tp_fp, tp_fn)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pred_tns</strong> (<em>torch.Tensor</em><em> [</em><em>batch_size</em><em>, </em><em>1</em><em>]</em>) – tensors of 1.0 and 0.0 stacked batch_size high</p></li>
<li><p><strong>label_tns</strong> (<em>torch.Tensor</em><em> [</em><em>batch_size</em><em>, </em><em>1</em><em>]</em>) – 1.0 or 2.0 true labels stacked batch_size high</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>precision values tp, tp_fp, tp_fn</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>[int,int,int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.gpu_obj_from_devid">
<span class="sig-name descname"><span class="pre">gpu_obj_from_devid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">devid</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.gpu_obj_from_devid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.human_readable">
<span class="sig-name descname"><span class="pre">human_readable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'B'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.human_readable" title="Permalink to this definition">¶</a></dt>
<dd><p>Create human readable string from a
(usually large) number of bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num</strong> (<em>int</em>) – the number to convert</p></li>
<li><p><strong>suffix</strong> (<em>str</em>) – desired suffix in the 
output (default B for Bytes)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>human readable str. such as
13MB, or 140TB</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.init_defaults">
<span class="sig-name descname"><span class="pre">init_defaults</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">configparser_obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.init_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Used when no config file is provided.
Not really needed any more, as a config
file path is now required in the command
line.</p>
<p>Initialize the standard entries.</p>
<p>Though not having the root of the train/test
samples should probably be an error.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>configparser_obj</strong> (<em>configparser</em>) – an empty configparser instance</p>
</dd>
</dl>
<p>:return the same config parser object filled-in 
:rtype configparser</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.init_multiprocessing">
<span class="sig-name descname"><span class="pre">init_multiprocessing</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.init_multiprocessing" title="Permalink to this definition">¶</a></dt>
<dd><p>Called once by each copy of this 
training script. Hangs until all
copies of the script are ready to
go.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.init_neural_net_parms">
<span class="sig-name descname"><span class="pre">init_neural_net_parms</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checkpoint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit_testing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.init_neural_net_parms" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds all neural net related hyper parameter values
in the configuration, and assigns them to instance
vars. If checkpoint is provided it must be a file
path to a previously saved, partially trained model.
That checkpoint will be loaded. Else network initialization
occurs from scratch.</p>
<p>Creates a network</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>checkpoint</strong> (<em>{None | str}</em>) – optional path to previously saved
model</p></li>
<li><p><strong>unit_testing</strong> (<em>bool</em>) – early return if unit testing</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.initialize_config_struct">
<span class="sig-name descname"><span class="pre">initialize_config_struct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.initialize_config_struct" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a config dict of dict with
the application’s configurations. Sections
will be:</p>
<blockquote>
<div><p>config[‘Paths’]       -&gt; dict[attr : val]
config[‘Training’]    -&gt; dict[attr : val]
config[‘Parallelism’] -&gt; dict[attr : val]</p>
</div></blockquote>
<p>The config read method will handle config_info
being None.</p>
<p>If config_info is a string, it is assumed either 
to be a file containing the configuration, or
a JSON string that defines the config.</p>
<p>Else config_info is assumed to be a NeuralNetConfig.
The latter is relevant only if using this file
as a library, rather than a command line tool.</p>
<p>If given a NeuralNetConfig instance, it is returned
unchanged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config_info</strong> (<em>{NeuralNetConfig | str}</em>) – the information needed to construct
the structure</p>
</dd>
</dl>
<dl class="simple">
<dt>:return a NeuralNetConfig instance with all parms</dt><dd><p>initialized</p>
</dd>
</dl>
<p>:rtype NeuralNetConfig</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.initialize_data_access">
<span class="sig-name descname"><span class="pre">initialize_data_access</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_grayscale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.initialize_data_access" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates dataset and dataloader instances.
If operating in Distributed Data Parallel,
calls init_process_group().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch_size</strong> (<em>int</em>) – desired batch size</p></li>
<li><p><strong>to_grayscale</strong> (<em>bool</em>) – do or do not tell dataset
to convert images to grayscale as the
are pulled from disk</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a dataloader in the pytorch sense</p>
</dd>
</dl>
<p>:rtype CrossValidatingDataLoader, or subclass</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.json_log_filename">
<span class="sig-name descname"><span class="pre">json_log_filename</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.json_log_filename" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.load_model_checkpoint">
<span class="sig-name descname"><span class="pre">load_model_checkpoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fresh_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fresh_optimizer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.load_model_checkpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore a model previously saved using
save_model_checkpoint() such that training 
can resume.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src_path</strong> (<em>str</em>) – path where the app_state is stored</p></li>
<li><p><strong>fresh_model</strong> (<em>torch model</em>) – a new, uninitialized instance of the model used</p></li>
<li><p><strong>fresh_optimizer</strong> (<em>torch optimizer</em>) – a new, uninitialized instance of the optimizer used</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dict with the initialized model, 
optimizer, last completed epoch, most recent
loss measure, and tallies collection.</p>
</dd>
</dl>
<p>:rtype {str : <a href="#id1"><span class="problematic" id="id2">*</span></a>}</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.mean_diff">
<span class="sig-name descname"><span class="pre">mean_diff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.mean_diff" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a tensor, return the absolute value
of the mean of the differences between successive
elements. Used to detect plateaus during
successive computations. Only intended
for 1D tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<em>torch.Tensor</em>) – tensor of dim 1</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>mean of differences between 
successive elements. Or nan if 
tensor only has one element.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.offer_model_save">
<span class="sig-name descname"><span class="pre">offer_model_save</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.offer_model_save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.pop_tensor">
<span class="sig-name descname"><span class="pre">pop_tensor</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.pop_tensor" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a previously pushed tensor.
If a GPU is being used, moves the
tensor to the CPU, and returns that
new tensor.</p>
<p>If only CPU is in use, returns a previously
pushed tensor, but there is no GPU/CPU
movement attempted.</p>
<p>In both cases, popping from an empty stack
raises a IndexError.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a tensor; either one that was already
in the CPU, or one that results from moving
a tensor from the GPU to the CPU</p>
</dd>
</dl>
<p>:raises IndexError when popping from an empty stack</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.prep_model">
<span class="sig-name descname"><span class="pre">prep_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">local_rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.prep_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a (usually CPU-resident) model,
and:</p>
<blockquote>
<div><p>o moves is to GPU if possible</p>
<dl>
<dt>o if self.independent_runs is False,</dt><dd><p>concludes that running in distributed data parallel
(DDP) and:</p>
<dl class="simple">
<dt>if a GPU will be used, wraps the model</dt><dd><p>in a DistributedDataModel instance for
participation in distributed data parallel
operations. The result will reside on 
GPU with ID (index) local_rank</p>
</dd>
</dl>
</dd>
</dl>
<p>o Without GPU in use, returns the model unchanged</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>pytorch.nn.model</em>) – a pytorch model instance</p></li>
<li><p><strong>local_rank</strong> (<em>int</em>) – id of GPU</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.push_tensor">
<span class="sig-name descname"><span class="pre">push_tensor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tnsr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.push_tensor" title="Permalink to this definition">¶</a></dt>
<dd><p>If GPU is in use, moves tnsr to 
the GPU, and returns that new tensor.
That newly moved tensor is saved in 
an array for tensor_pop() later.</p>
<p>When no GPU is in use, return tnsr
unchanged, but also track the tensor
in a stack for subsequent tensor_pop()
operations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tnsr</strong> (<em>torch.Tensor</em>) – tensor to move to GPU, or
‘pretend’ to move there</p>
</dd>
</dl>
<dl class="simple">
<dt>:return a tensor; either a newly GPU resident</dt><dd><p>one, or the tnsr itself</p>
</dd>
</dl>
<p>:raise ValueError if tnsr is not a tensor</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.read_configuration">
<span class="sig-name descname"><span class="pre">read_configuration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conf_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.read_configuration" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses config file that describes training parameters,
various file paths, and how many GPUs different machines have.
Syntax follows Python’s configfile package, which includes
sections, and attr/val pairs in each section.</p>
<p>Expected sections:</p>
<blockquote>
<div><p>o Paths: various file paths for the application
o Training: holds batch sizes, number of epochs, etc.
o Parallelism: holds number of GPUs on different machines</p>
</div></blockquote>
<p>For Parallelism, expect entries like:</p>
<blockquote>
<div><p>foo.bar.com  = 4
127.0.0.1    = 5
localhost    = 3
172.12.145.1 = 6</p>
</div></blockquote>
<p>Method identifies which of the entries is
‘localhost’ by comparing against local hostname.
Though ‘localhost’ or ‘127.0.0.1’ may be provided.</p>
<dl class="simple">
<dt>Returns a dict of dicts: </dt><dd><p>config[section-names][attr-names-within-section]</p>
</dd>
</dl>
<p>Types of standard entries, such as epochs, batch_size,
etc. are coerced, so that, e.g. config[‘Training’][‘epochs’]
will be an int. Clients may add non-standard entries.
For those the client must convert values from string
(the type in which values are stored by default) to the
required type. This can be done the usual way: int(…),
or using one of the configparser’s retrieval methods
getboolean(), getint(), and getfloat():</p>
<blockquote>
<div><p>config[‘Training’].getfloat(‘learning_rate’)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other_gpu_config_file</strong> (<em>str</em>) – path to configuration file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a dict of dicts mirroring the config file sections/entries</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict[dict]</p>
</dd>
</dl>
<p>:raises ValueErr
:raises TypeError</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.record_json_display_results">
<span class="sig-name descname"><span class="pre">record_json_display_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.record_json_display_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Amy Dunphy’s confusion matrix heatmaps
that are labeled at the edges with class
names needs a particularly formated json
file. Write one epoch’s worth of performance
summaries to that file.</p>
<dl class="simple">
<dt>Assumption: setup_json_logging() was called</dt><dd><p>before the call to this method.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.record_tensorboard_results">
<span class="sig-name descname"><span class="pre">record_tensorboard_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.record_tensorboard_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Called at the end of each epoch. Writes
all epoch-level measures to tensorboard.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>epoch</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.remember_output_and_label">
<span class="sig-name descname"><span class="pre">remember_output_and_label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">outputs</span></em>, <em class="sig-param"><span class="pre">targets</span></em>, <em class="sig-param"><span class="pre">output_stack=None</span></em>, <em class="sig-param"><span class="pre">label_stack=None</span></em>, <em class="sig-param"><span class="pre">learning_phase=&lt;LearningPhase.TRAINING:</span> <span class="pre">1&gt;</span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.remember_output_and_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Both training and validation run through a loop
of batches. Not every single iteration’s results
need to be represented in the performance logs.
Instead, the output-prob/correct-label pairs are
accumulated in an output_stack and label_stack,
respectively.</p>
<p>This method adds one ouput/label pair to their
respective stacks. The tally_result() method will
be called after the end of each split, and it will
expect the two stacks.</p>
<p>Clients are responsible for setting output_stack and
label_stack to None after each split. They are also 
responsible for preserving the returned values for the
next call to this method. I.e. this method does not
store output_stack or label_stack anywhere.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> (<em>Tensor</em><em> [</em><em>batch_size x num_classes</em><em>]</em>) – an output tensor from the model</p></li>
<li><p><strong>targets</strong> (<em>Tensor</em><em> [</em><em>batch_size x 1</em><em>]</em>) – correct label for each sample in batch</p></li>
<li><p><strong>output_stack</strong> (<em>[</em><em>Tensor</em><em>]</em>) – current (partially filled) stack
of model outputs</p></li>
<li><p><strong>label_stack</strong> – current (partially filled) stack 
of labels</p></li>
</ul>
</dd>
</dl>
<p>:type label_stack:[Tensor]
:param learning_phase: whether currently training or validating 
:type learning_phase: LearningPhase
:return: tuple of updated (output_stack, label_stack)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.report_hparams_summary">
<span class="sig-name descname"><span class="pre">report_hparams_summary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tally_coll</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">network_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_pretrained_layers</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.report_hparams_summary" title="Permalink to this definition">¶</a></dt>
<dd><p>Called at the end of training. Constructs
a summary to report for the hyperparameters
used in this process. Reports to the tensorboard.</p>
<p>Hyperparameters reported:</p>
<blockquote>
<div><p>o lr
o optimizer
o batch_size
o kernel_size</p>
</div></blockquote>
<p>Included in the measures are:</p>
<blockquote>
<div><p>o balanced_adj_accuracy_score_train
o balanced_adj_accuracy_score_val
o mean_accuracy_train
o mean_accuracy_val
o epoch_mean_weighted_precision
o epoch_mean_weighted_recall
o epoch_loss_train
o epoch_loss_val</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tally_coll</strong> (<em>TrainResultCollection</em>) – the collection of results for
each epoch</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.request_interrupt_training">
<span class="sig-name descname"><span class="pre">request_interrupt_training</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stacktrace</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.request_interrupt_training" title="Permalink to this definition">¶</a></dt>
<dd><p>Interrupt handler for cnt-C (SIGINT). 
Set STOP flag. Training checks that flag
periodically, and raises the InterruptTraining
exception. That in turn asks user whether to
save current training state for later resumption</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.save_model_checkpoint">
<span class="sig-name descname"><span class="pre">save_model_checkpoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dest_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.save_model_checkpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the entire current state of training.
Re-instate that checkpoint in a new session
by using self.load_model_checkpoint()</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dest_path</strong> (<em>str</em>) – absolute path where to save the 
pickled model. Use .pth or .tar extension</p></li>
<li><p><strong>model</strong> (<em>torch model class</em>) – the model instance to save</p></li>
<li><p><strong>optimizer</strong> (<em>torch optimizer class</em>) – the optimizer instance to save</p></li>
<li><p><strong>epoch</strong> (<em>int</em>) – the last finished epoch</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.select_loss_function">
<span class="sig-name descname"><span class="pre">select_loss_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.select_loss_function" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.select_optimizer">
<span class="sig-name descname"><span class="pre">select_optimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.select_optimizer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.set_seed">
<span class="sig-name descname"><span class="pre">set_seed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.set_seed" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the seed across all different necessary platforms
to allow for comparison of different models and runs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>seed</strong> (<em>int</em>) – random seed to set for all random num generators</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.setup_gpus">
<span class="sig-name descname"><span class="pre">setup_gpus</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.setup_gpus" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.setup_json_logging">
<span class="sig-name descname"><span class="pre">setup_json_logging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">json_log_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.setup_json_logging" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.setup_tallying">
<span class="sig-name descname"><span class="pre">setup_tallying</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_classes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.setup_tallying" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.setup_tensorboard">
<span class="sig-name descname"><span class="pre">setup_tensorboard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logdir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.setup_tensorboard" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize tensorboard. To easily compare experiments,
use runs/exp1, runs/exp2, etc.</p>
<p>Method creates the dir if needed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>logdir</strong> (<em>str</em>) – root for tensorboard events</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.tally_result">
<span class="sig-name descname"><span class="pre">tally_result</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels_tns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_prob_tns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learning_phase</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.tally_result" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>Given:</dt><dd><dl class="simple">
<dt>o the results of a train or validation run</dt><dd><p>through all batches of one split (i.e. configuration
of folds into train + 1-validate,</p>
</dd>
</dl>
<p>o the true labels for each sample
o the total accumulated loss in this split
o the phase of the process (train/validate/test)</p>
</dd>
</dl>
<p>Creates and retains a confusion matrix from 
which all other values, such as precision/recall
can be derived in the related methods of the 
TrainResult class. The matrix is handed to a
new TrainResult instance, and that instance is
added to self.tally_collection.</p>
<p>The confusion matrix’s row indices will correspond
the true class IDs; the column indices correspond to
the predicted classes:</p>
<blockquote>
<div><blockquote>
<div><p>pred class0 pred class2 pred class3</p>
</div></blockquote>
<p>known class 0      num-pred    num_pred     num_pred
known class 1      num_pred    num_pred     num_pred
known class 2         …        …          …</p>
</div></blockquote>
<p>As passed in, pred_prob_tns is:</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><dl class="simple">
<dt>[num_batches x batch_size x num_classes]</dt><dd><p>^             ^            ^
|             |            |</p>
</dd>
</dl>
</div></blockquote>
<p>all batches      result for    logits for each
from a single   each sample    target class</p>
</div></blockquote>
<p>split == num_folds  in one batch</p>
</div></blockquote>
<p>This method resolves that stack to:</p>
<blockquote>
<div><blockquote>
<div><dl class="simple">
<dt>[num_batches x batch_size]</dt><dd><p>^             ^
|             |</p>
</dd>
</dl>
</div></blockquote>
<p>[[predicted_class_sample1_batch1, predicted_class_sample2_batch1],
[[predicted_class_sample1_batch2, predicted_class_sample2_batch2],</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>…</p>
</div></blockquote>
<p>as many rows as there are</p>
</div></blockquote>
<p>folds to permute in the cross-val</p>
<blockquote>
<div><p>predicted_classes = torch.argmax(output_stack, dim=2)</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<p>The sklearn conf_matrix method is then used.</p>
<dl class="simple">
<dt>Logging Results: after the validation of each split</dt><dd><p>is complete, means of results for the split are
logged. Since this method is called both after
one split’s training, and again after that split’s
validation, logging is delayed until a tally for
the validation phase is being created.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels_tns</strong> (<em>torch.Tensor</em><em> (</em><em>integer class IDs</em><em>)</em>) – ground truth labels for batch</p></li>
<li><p><strong>pred_prob_tns</strong> (<em>torch.Tensor</em>) – model prediction probabilities</p></li>
<li><p><strong>loss</strong> (<em>torch.Tensor</em><em> (</em><em>float</em><em>)</em>) – accumulated result of loss function from
run through all the folds.</p></li>
<li><p><strong>learning_phase</strong> (<a class="reference internal" href="birdsong.utils.html#birdsong.utils.learning_phase.LearningPhase" title="birdsong.utils.learning_phase.LearningPhase"><em>LearningPhase</em></a>) – phase under which to record this
result: training, validation, or test.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.time_diff">
<span class="sig-name descname"><span class="pre">time_diff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datetime1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datetime2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.time_diff" title="Permalink to this definition">¶</a></dt>
<dd><p>Given two datetime instances as returned by
datetime.datetime.now(), return the difference in 
seconds.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datetime1</strong> (<em>datetime</em>) – earlier time</p></li>
<li><p><strong>datetime2</strong> (<em>datetime</em>) – later time</p></li>
</ul>
</dd>
</dl>
<p>:return difference in seconds
:rtype int</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.to_best_device">
<span class="sig-name descname"><span class="pre">to_best_device</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.to_best_device" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Orchestrate the training and validation.
This method works with cross validation,
and interoperates closely with train_one_split()
and validate_one_split().</p>
<dl>
<dt>Assumptions:</dt><dd><dl class="simple">
<dt>o self.epoch is either 0, or set to where a </dt><dd><p>previously saved model left off</p>
</dd>
</dl>
<p>o self.model is ready to generate output</p>
</dd>
</dl>
<p>Method feeds results to Tensorboard.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.train_one_split">
<span class="sig-name descname"><span class="pre">train_one_split</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.train_one_split" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a <em>generator</em> function, which 
trains from one split, then yields for
the next split_num.</p>
<dl>
<dt>Usage:</dt><dd><p>gen = self.train_one_split()
gen.send(None)
while True:</p>
<blockquote>
<div><p>gen.send(new_split_num)</p>
</div></blockquote>
<p>… till this method raises StopIteration</p>
</dd>
</dl>
<p>The first gen.send(None) causes the first 
yield statement below. All subsequent yields
will occur in the second yield.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.validate_one_split">
<span class="sig-name descname"><span class="pre">validate_one_split</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.validate_one_split" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.BirdTrainer.write_json_record">
<span class="sig-name descname"><span class="pre">write_json_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tally</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">incorrect_paths</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.birds_train_parallel.BirdTrainer.write_json_record" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.InterruptTraining">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.birds_train_parallel.</span></span><span class="sig-name descname"><span class="pre">InterruptTraining</span></span><a class="headerlink" href="#birdsong.birds_train_parallel.InterruptTraining" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.NoGPUAvailable">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.birds_train_parallel.</span></span><span class="sig-name descname"><span class="pre">NoGPUAvailable</span></span><a class="headerlink" href="#birdsong.birds_train_parallel.NoGPUAvailable" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="birdsong.birds_train_parallel.TrainError">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.birds_train_parallel.</span></span><span class="sig-name descname"><span class="pre">TrainError</span></span><a class="headerlink" href="#birdsong.birds_train_parallel.TrainError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

</div>
<div class="section" id="module-birdsong.class_weight_discovery">
<span id="birdsong-class-weight-discovery-module"></span><h2>birdsong.class_weight_discovery module<a class="headerlink" href="#module-birdsong.class_weight_discovery" title="Permalink to this headline">¶</a></h2>
<p>Created on Jan 21, 2021</p>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.class_weight_discovery.ClassWeightDiscovery">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.class_weight_discovery.</span></span><span class="sig-name descname"><span class="pre">ClassWeightDiscovery</span></span><a class="headerlink" href="#birdsong.class_weight_discovery.ClassWeightDiscovery" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Given a root directory, finds all 
subdirectories that do not begin with 
a dot, and contain at least one non-directory
file that does not begin with a dot. It is 
assumed that the last path element of such 
diretories name a class. This arrangment is 
common in pytorch.</p>
<p>For each directory, find the number of non-directory,
non-dot-starting files. These numbers imply
a weight, with the number of files in the most
populated directory assigned the weight 1.0</p>
<p>The class names are sorted in natural sort order.
Natural order means that Foo30 is placed after
Foo3.</p>
<p>Each class is then associated with a weight. The
result is a tensor of weight, arranged to correspond
to the natural-sorted classes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.class_weight_discovery.ClassWeightDiscovery.get_weights">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">get_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_root</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.class_weight_discovery.ClassWeightDiscovery.get_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Given to root of a subdirectory,
return a tensor of weights. The order
of the weights corresponds to the 
naturally sorted class names.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_root</strong> (<em>str</em>) – full path to root
of data file subtree</p>
</dd>
</dl>
<p>:return weights in naturally sorted class order
:rtype: Tensor</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.conv_matrix">
<span id="birdsong-conv-matrix-module"></span><h2>birdsong.conv_matrix module<a class="headerlink" href="#module-birdsong.conv_matrix" title="Permalink to this headline">¶</a></h2>
<p>Created on May 4, 2021</p>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.conv_matrix.ConvMatrix">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.conv_matrix.</span></span><span class="sig-name descname"><span class="pre">ConvMatrix</span></span><a class="headerlink" href="#birdsong.conv_matrix.ConvMatrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>classdocs</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.conv_matrix.ConvMatrix.conf_matrix">
<span class="sig-name descname"><span class="pre">conf_matrix</span></span><em class="property"> <span class="pre">=</span> <span class="pre">array([[24,</span> <span class="pre">13,</span> <span class="pre">13,</span> <span class="pre">...,</span> <span class="pre">10,</span> <span class="pre">14,</span> <span class="pre">14],</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">[24,</span> <span class="pre">13,</span> <span class="pre">13,</span> <span class="pre">...,</span> <span class="pre">10,</span> <span class="pre">14,</span> <span class="pre">14]])</span></em><a class="headerlink" href="#birdsong.conv_matrix.ConvMatrix.conf_matrix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.conv_matrix.ConvMatrix.val_pred">
<span class="sig-name descname"><span class="pre">val_pred</span></span><em class="property"> <span class="pre">=</span> <span class="pre">tensor([24,</span> <span class="pre">13,</span> <span class="pre">13,</span>&#160; <span class="pre">...,</span> <span class="pre">10,</span> <span class="pre">14,</span> <span class="pre">14])</span></em><a class="headerlink" href="#birdsong.conv_matrix.ConvMatrix.val_pred" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.conv_matrix.ConvMatrix.val_truth">
<span class="sig-name descname"><span class="pre">val_truth</span></span><em class="property"> <span class="pre">=</span> <span class="pre">tensor([24,</span> <span class="pre">13,</span> <span class="pre">13,</span>&#160; <span class="pre">...,</span> <span class="pre">10,</span> <span class="pre">14,</span> <span class="pre">14])</span></em><a class="headerlink" href="#birdsong.conv_matrix.ConvMatrix.val_truth" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.cross_validation_dataloader">
<span id="birdsong-cross-validation-dataloader-module"></span><h2>birdsong.cross_validation_dataloader module<a class="headerlink" href="#module-birdsong.cross_validation_dataloader" title="Permalink to this headline">¶</a></h2>
<p>Created on Dec 13, 2020</p>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.cross_validation_dataloader.</span></span><span class="sig-name descname"><span class="pre">CrossValidatingDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefetch_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_last</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.utils.data.dataloader.T_co</span></code>]</p>
<p>Subclass of torch.utils.data.DataLoader. Provides
stratified k-fold crossvalidation in single-machine,
(optionally) single-GPU context.</p>
<p>Instantiate this class if running only on a
single machine, optionally using a single GPU. Else,
instantiate the MultiprocessingDataLoader subclass 
instead.</p>
<p>An instance of this class wraps any dict-API dataset instance, 
which provides tuples , for instance (&lt;img-tensor&gt;, class-label-int) 
from the file system when given a sample ID.</p>
<p>This subclass of torch.utils.data.DataLoader specilizes
the default by using a stratified k-fold cross validation
sampler. That underlying sampler manages partitioning of
samples into folds, and successively feeding samples from
the training folds. The sampler also manages the ‘switching out’
of folds to take the role of test fold in round robin fashion.</p>
<p>This DataLoader instance also managing combination of 
samples into batches.</p>
<p>An instance of this class presents an iterator API, additionally
serving the test samples whenever one set of train folds are 
exhausted. Example: assume</p>
<blockquote>
<div><p>o k-fold cross validation k = 5</p>
<p>for split in range(k):</p>
<blockquote>
<div><dl class="simple">
<dt>for batch in my_dataloader:</dt><dd><dl class="simple">
<dt>try:</dt><dd><p>&lt;feed training batch to emerging model&gt;</p>
</dd>
<dt>except EndOfSplit as e:</dt><dd><p>print(e.message) # Just for debugging
break</p>
</dd>
</dl>
</dd>
</dl>
<p># Exhausted all train folds of one split
# Now test current state of the 
# model using this split’s test samples,
# which are available as an iterator from the
# dataloader:</p>
<dl class="simple">
<dt>for (img_tensor, label) in my_ataloader.validation_samples():</dt><dd><p>&lt;test model on img_tensor&gt;</p>
</dd>
</dl>
<p># next split</p>
</div></blockquote>
</div></blockquote>
<p>The validation_samples() method is a generator that provides the content of 
the just exhausted split’s validation samples.</p>
<dl>
<dt>NOTE: when re-setting an instance of this class</dt><dd><p>for a new epoch, client must call set_epoch()
with the new epoch number to ensure proper
shuffling randomness. Such a reset occurs implicitly
with the often used idiom:</p>
<blockquote>
<div><p>for i,res = enumerate(dataloader)</p>
</div></blockquote>
<p>The enumerate() starts the same dataloader instance
from the beginning.</p>
<p>If shuffle is False, set_epoch() needs not be called.
But doing so does no harm.</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.batch_size">
<span class="sig-name descname"><span class="pre">batch_size</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.batch_size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.class_from_sample_id">
<span class="sig-name descname"><span class="pre">class_from_sample_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.class_from_sample_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a sample ID, return its class index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sample_id</strong> (<em>int</em>) – ID to look up</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>given sample’s class ID</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.dataset">
<span class="sig-name descname"><span class="pre">dataset</span></span><em class="property"><span class="pre">:</span> <span class="pre">torch.utils.data.dataset.Dataset</span><span class="p"><span class="pre">[</span></span><span class="pre">torch.utils.data.dataloader.T_co</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.dataset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.drop_last">
<span class="sig-name descname"><span class="pre">drop_last</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.drop_last" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.file_from_sample_id">
<span class="sig-name descname"><span class="pre">file_from_sample_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.file_from_sample_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a sample_id, return the absolute
file path of the corresponding sample
in the file system.</p>
<p>We use the public dataset method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sample_id</strong> (<em>int</em>) – sample ID to look up</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.get_curr_fold_idx">
<span class="sig-name descname"><span class="pre">get_curr_fold_idx</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.get_curr_fold_idx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.get_split_test_sample_ids">
<span class="sig-name descname"><span class="pre">get_split_test_sample_ids</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.get_split_test_sample_ids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.num_workers">
<span class="sig-name descname"><span class="pre">num_workers</span></span><em class="property"><span class="pre">:</span> <span class="pre">int</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.num_workers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.pin_memory">
<span class="sig-name descname"><span class="pre">pin_memory</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.pin_memory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.prefetch_factor">
<span class="sig-name descname"><span class="pre">prefetch_factor</span></span><em class="property"><span class="pre">:</span> <span class="pre">int</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.prefetch_factor" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.sampler">
<span class="sig-name descname"><span class="pre">sampler</span></span><em class="property"><span class="pre">:</span> <span class="pre">torch.utils.data.sampler.Sampler</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.sampler" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.set_epoch">
<span class="sig-name descname"><span class="pre">set_epoch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_epoch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.set_epoch" title="Permalink to this definition">¶</a></dt>
<dd><p>Must be called by client every time
a new epoch starts. The epoch number
is used by the sampler to shuffle
the dataset before beginning to draw
samples.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>new_epoch</strong> (<em>int</em>) – the epoch under which the dataloader
is (re)started</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.timeout">
<span class="sig-name descname"><span class="pre">timeout</span></span><em class="property"><span class="pre">:</span> <span class="pre">float</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.timeout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.CrossValidatingDataLoader.validation_samples">
<span class="sig-name descname"><span class="pre">validation_samples</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.CrossValidatingDataLoader.validation_samples" title="Permalink to this definition">¶</a></dt>
<dd><p>Generator that runs through every
test sample_id of the current fold, 
and feeds (&lt;img_tensor, label) pairs.</p>
<blockquote>
<div><dl class="simple">
<dt>for (img_tensor, label) in my_bird_dataloader.validation_samples():</dt><dd><p>&lt;test model&gt;</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.EndOfSplit">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.cross_validation_dataloader.</span></span><span class="sig-name descname"><span class="pre">EndOfSplit</span></span><a class="headerlink" href="#birdsong.cross_validation_dataloader.EndOfSplit" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.cross_validation_dataloader.</span></span><span class="sig-name descname"><span class="pre">MultiprocessingDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefetch_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_last</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.utils.data.dataloader.T_co</span></code>]</p>
<p>Use this class for dataloader if running using
multiple machines, or using multiple GPUs on a
single machine.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader.batch_size">
<span class="sig-name descname"><span class="pre">batch_size</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader.batch_size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader.dataset">
<span class="sig-name descname"><span class="pre">dataset</span></span><em class="property"><span class="pre">:</span> <span class="pre">torch.utils.data.dataset.Dataset</span><span class="p"><span class="pre">[</span></span><span class="pre">torch.utils.data.dataloader.T_co</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader.dataset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader.drop_last">
<span class="sig-name descname"><span class="pre">drop_last</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader.drop_last" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader.num_workers">
<span class="sig-name descname"><span class="pre">num_workers</span></span><em class="property"><span class="pre">:</span> <span class="pre">int</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader.num_workers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader.pin_memory">
<span class="sig-name descname"><span class="pre">pin_memory</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader.pin_memory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader.prefetch_factor">
<span class="sig-name descname"><span class="pre">prefetch_factor</span></span><em class="property"><span class="pre">:</span> <span class="pre">int</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader.prefetch_factor" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader.sampler">
<span class="sig-name descname"><span class="pre">sampler</span></span><em class="property"><span class="pre">:</span> <span class="pre">torch.utils.data.sampler.Sampler</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader.sampler" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.MultiprocessingDataLoader.timeout">
<span class="sig-name descname"><span class="pre">timeout</span></span><em class="property"><span class="pre">:</span> <span class="pre">float</span></em><a class="headerlink" href="#birdsong.cross_validation_dataloader.MultiprocessingDataLoader.timeout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.cat">
<span class="sig-prename descclassname"><span class="pre">birdsong.cross_validation_dataloader.</span></span><span class="sig-name descname"><span class="pre">cat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Tensor</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.cat" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenates the given sequence of <code class="xref py py-attr docutils literal notranslate"><span class="pre">seq</span></code> tensors in the given dimension.
All tensors must either have the same shape (except in the concatenating
dimension) or be empty.</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.cat()</span></code> can be seen as an inverse operation for <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.split()</span></code>
and <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.chunk()</span></code>.</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.cat()</span></code> can be best understood via examples.</p>
<dl>
<dt>Args:</dt><dd><dl class="simple">
<dt>tensors (sequence of Tensors): any python sequence of tensors of the same type.</dt><dd><p>Non-empty tensors provided must have the same shape, except in the
cat dimension.</p>
</dd>
</dl>
<p>dim (int, optional): the dimension over which the tensors are concatenated</p>
</dd>
<dt>Keyword args:</dt><dd><p>out (Tensor, optional): the output tensor.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">tensor([[ 0.6580, -1.0969, -0.4614],</span>
<span class="go">        [-0.1034, -0.5790,  0.1497]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">tensor([[ 0.6580, -1.0969, -0.4614],</span>
<span class="go">        [-0.1034, -0.5790,  0.1497],</span>
<span class="go">        [ 0.6580, -1.0969, -0.4614],</span>
<span class="go">        [-0.1034, -0.5790,  0.1497],</span>
<span class="go">        [ 0.6580, -1.0969, -0.4614],</span>
<span class="go">        [-0.1034, -0.5790,  0.1497]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">tensor([[ 0.6580, -1.0969, -0.4614,  0.6580, -1.0969, -0.4614,  0.6580,</span>
<span class="go">         -1.0969, -0.4614],</span>
<span class="go">        [-0.1034, -0.5790,  0.1497, -0.1034, -0.5790,  0.1497, -0.1034,</span>
<span class="go">         -0.5790,  0.1497]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="birdsong.cross_validation_dataloader.unsqueeze">
<span class="sig-prename descclassname"><span class="pre">birdsong.cross_validation_dataloader.</span></span><span class="sig-name descname"><span class="pre">unsqueeze</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Tensor</span><a class="headerlink" href="#birdsong.cross_validation_dataloader.unsqueeze" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new tensor with a dimension of size one inserted at the
specified position.</p>
<p>The returned tensor shares the same underlying data with this tensor.</p>
<p>A <code class="xref py py-attr docutils literal notranslate"><span class="pre">dim</span></code> value within the range <code class="docutils literal notranslate"><span class="pre">[-input.dim()</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">input.dim()</span> <span class="pre">+</span> <span class="pre">1)</span></code>
can be used. Negative <code class="xref py py-attr docutils literal notranslate"><span class="pre">dim</span></code> will correspond to <a class="reference internal" href="#birdsong.cross_validation_dataloader.unsqueeze" title="birdsong.cross_validation_dataloader.unsqueeze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unsqueeze()</span></code></a>
applied at <code class="xref py py-attr docutils literal notranslate"><span class="pre">dim</span></code> = <code class="docutils literal notranslate"><span class="pre">dim</span> <span class="pre">+</span> <span class="pre">input.dim()</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>input (Tensor): the input tensor.
dim (int): the index at which to insert the singleton dimension</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">tensor([[ 1,  2,  3,  4]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">tensor([[ 1],</span>
<span class="go">        [ 2],</span>
<span class="go">        [ 3],</span>
<span class="go">        [ 4]])</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-birdsong.display">
<span id="birdsong-display-module"></span><h2>birdsong.display module<a class="headerlink" href="#module-birdsong.display" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.display.App">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.display.</span></span><span class="sig-name descname"><span class="pre">App</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">LOG_FILEPATH</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.App" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">PyQt5.QtWidgets.QMainWindow</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.App.cross_check">
<span class="sig-name descname"><span class="pre">cross_check</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.App.cross_check" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.display.LeftSideWidget">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.display.</span></span><span class="sig-name descname"><span class="pre">LeftSideWidget</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LeftSideWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">PyQt5.QtWidgets.QWidget</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.display.LogReader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.display.</span></span><span class="sig-name descname"><span class="pre">LogReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">LOG_FILEPATH</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.calcMAP">
<span class="sig-name descname"><span class="pre">calcMAP</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.calcMAP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.calc_conf_matrix_norm">
<span class="sig-name descname"><span class="pre">calc_conf_matrix_norm</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.calc_conf_matrix_norm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.genTru">
<span class="sig-name descname"><span class="pre">genTru</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.genTru" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getBatch">
<span class="sig-name descname"><span class="pre">getBatch</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getBatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getConfusion">
<span class="sig-name descname"><span class="pre">getConfusion</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getConfusion" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getEpoch">
<span class="sig-name descname"><span class="pre">getEpoch</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getEpoch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getFileMatrix">
<span class="sig-name descname"><span class="pre">getFileMatrix</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getFileMatrix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getKernel">
<span class="sig-name descname"><span class="pre">getKernel</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getKernel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getKernelBatch">
<span class="sig-name descname"><span class="pre">getKernelBatch</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getKernelBatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getLoss">
<span class="sig-name descname"><span class="pre">getLoss</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getLoss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getMAP">
<span class="sig-name descname"><span class="pre">getMAP</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getMAP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getNormalized">
<span class="sig-name descname"><span class="pre">getNormalized</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getNormalized" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getTestingAccuracy">
<span class="sig-name descname"><span class="pre">getTestingAccuracy</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getTestingAccuracy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.getTrainingAccuracy">
<span class="sig-name descname"><span class="pre">getTrainingAccuracy</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.getTrainingAccuracy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.readLine">
<span class="sig-name descname"><span class="pre">readLine</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.readLine" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.LogReader.safe_eval">
<span class="sig-name descname"><span class="pre">safe_eval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.LogReader.safe_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a string that can be interpreted
as a Python expression, evaluate the expression
safely, and return the result.</p>
<p>Evaluating safely means that no Python 
is available to the eval process: not 
built-in, or library functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>item</strong> (<em>str</em>) – a Python expression</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>evaluated Python</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Any</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.display.OverallWidget">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.display.</span></span><span class="sig-name descname"><span class="pre">OverallWidget</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.OverallWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">PyQt5.QtWidgets.QWidget</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.display.PlotAccuracy">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.display.</span></span><span class="sig-name descname"><span class="pre">PlotAccuracy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.PlotAccuracy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">PyQt5.QtWidgets.QWidget</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.display.PlotConfusion">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.display.</span></span><span class="sig-name descname"><span class="pre">PlotConfusion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.PlotConfusion" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">PyQt5.QtWidgets.QWidget</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.PlotConfusion.onMotion">
<span class="sig-name descname"><span class="pre">onMotion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.PlotConfusion.onMotion" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.display.PlotLoss">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.display.</span></span><span class="sig-name descname"><span class="pre">PlotLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.PlotLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">PyQt5.QtWidgets.QWidget</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.display.RightSideWidget">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.display.</span></span><span class="sig-name descname"><span class="pre">RightSideWidget</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.RightSideWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">PyQt5.QtWidgets.QWidget</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.display.RightSideWidget.onRelease">
<span class="sig-name descname"><span class="pre">onRelease</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.display.RightSideWidget.onRelease" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="birdsong-distributed-c10d-module">
<h2>birdsong.distributed_c10d module<a class="headerlink" href="#birdsong-distributed-c10d-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-birdsong.ensembletrain">
<span id="birdsong-ensembletrain-module"></span><h2>birdsong.ensembletrain module<a class="headerlink" href="#module-birdsong.ensembletrain" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Ensemble">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.ensembletrain.</span></span><span class="sig-name descname"><span class="pre">Ensemble</span></span><a class="headerlink" href="#birdsong.ensembletrain.Ensemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Ensemble.test_bed">
<span class="sig-name descname"><span class="pre">test_bed</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Ensemble.test_bed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Ensemble.test_output">
<span class="sig-name descname"><span class="pre">test_output</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Ensemble.test_output" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Ensemble.train_models">
<span class="sig-name descname"><span class="pre">train_models</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Ensemble.train_models" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.ensembletrain.ImageFolderWithPaths">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.ensembletrain.</span></span><span class="sig-name descname"><span class="pre">ImageFolderWithPaths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">root</span></em>, <em class="sig-param"><span class="pre">transform=None</span></em>, <em class="sig-param"><span class="pre">target_transform=None</span></em>, <em class="sig-param"><span class="pre">loader=&lt;function</span> <span class="pre">default_loader&gt;</span></em>, <em class="sig-param"><span class="pre">is_valid_file=None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.ImageFolderWithPaths" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.utils.data.dataset.T_co</span></code>]</p>
<p>Custom dataset that includes image file paths. Extends
torchvision.datasets.ImageFolder</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Training">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.ensembletrain.</span></span><span class="sig-name descname"><span class="pre">Training</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">net_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'BasicNet'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gpu_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Training" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Training.cf_matrix">
<span class="sig-name descname"><span class="pre">cf_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_loader</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Training.cf_matrix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Training.configure_log">
<span class="sig-name descname"><span class="pre">configure_log</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Training.configure_log" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Training.get_net">
<span class="sig-name descname"><span class="pre">get_net</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_class</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gpu_index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Training.get_net" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Training.import_data">
<span class="sig-name descname"><span class="pre">import_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Training.import_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Training.set_seed">
<span class="sig-name descname"><span class="pre">set_seed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Training.set_seed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Training.test">
<span class="sig-name descname"><span class="pre">test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_loader</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Training.test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.ensembletrain.Training.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.ensembletrain.Training.train" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="birdsong-launch-birds-training-module">
<h2>birdsong.launch_birds_training module<a class="headerlink" href="#birdsong-launch-birds-training-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="birdsong-launch-multiprocessing-training-runs-module">
<h2>birdsong.launch_multiprocessing_training_runs module<a class="headerlink" href="#birdsong-launch-multiprocessing-training-runs-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="birdsong-launch-training-runs-module">
<h2>birdsong.launch_training_runs module<a class="headerlink" href="#birdsong-launch-training-runs-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-birdsong.nets">
<span id="birdsong-nets-module"></span><h2>birdsong.nets module<a class="headerlink" href="#module-birdsong.nets" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.nets.BasicNet">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.nets.</span></span><span class="sig-name descname"><span class="pre">BasicNet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_classes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.nets.BasicNet" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.nets.BasicNet.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.nets.BasicNet.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within
this function, one should call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards
instead of this since the former takes care of running the
registered hooks while the latter silently ignores them.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.nets.BasicNet.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#birdsong.nets.BasicNet.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.nets.NetUtils">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.nets.</span></span><span class="sig-name descname"><span class="pre">NetUtils</span></span><a class="headerlink" href="#birdsong.nets.NetUtils" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Creating neural networks. Main entry point
is method get_net(). Serves out a basic network
BasicNet, or a version of resnet (18, 34, 50).
When requesting resnets, caller can specify a nunmber
of layers to have pretrained. Thus a fully, or
partially pretrained resnet model can be obtained.</p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.nets.NetUtils.freeze_model_layers">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">freeze_model_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_to_freeze</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.nets.NetUtils.freeze_model_layers" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a model, freeze as num_to_freeze layers,
and return the model. Freezing a layer sets the required_grad
attribute of the layer’s weight tensors to False</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>pytorch.nn</em>) – model to partially freeze</p></li>
<li><p><strong>num_to_freeze</strong> (<em>int</em>) – how many layers to freeze</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>modified model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pytorch.nn</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.nets.NetUtils.get_model_ddp">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">get_model_ddp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">local_leader_rank</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">net_version</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pretrained</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freeze</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.nets.NetUtils.get_model_ddp" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine whether this process is the
master node. If so, obtain the pretrained
resnet18 model. Then distributed the model
to the other nodes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank</strong> (<em>int</em>) – this process’ rank
in the distributed data processing sense</p></li>
<li><p><strong>local_leader_rank</strong> (<em>int</em>) – the lowest rank on this machine</p></li>
<li><p><strong>log</strong> (<em>LoggingService</em>) – logging service to log to</p></li>
<li><p><strong>net_version</strong> (<em>int</em>) – which resnet version to obtain</p></li>
<li><p><strong>pretrained</strong> (<em>bool</em>) – if true, the pre-trained version
is obtained. Else initial weights are undefined</p></li>
<li><p><strong>freeze</strong> (<em>int</em>) – how many layers to
freeze, protecting them from training.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.nets.NetUtils.get_net">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">get_net</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net_name</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.nets.NetUtils.get_net" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.nets.NetUtils.name_and_version_from_net_name">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">name_and_version_from_net_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net_name_and_version</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.nets.NetUtils.name_and_version_from_net_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a network name with or without version, 
return:</p>
<blockquote>
<div><p>o (&lt;network_name&gt;, &lt;network_version&gt;)
o None if name cannot possibly be a traditionally</p>
<blockquote>
<div><p>formatted network name (e.g. starts with a digit)</p>
</div></blockquote>
<dl class="simple">
<dt>o (&lt;network_name&gt;, None) if network name had no</dt><dd><p>version.</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>Ex: returns (‘resnet’, 18) for input ‘resnet18’</dt><dd><p>returns (‘resnet’, None) for input ‘resnet’</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>net_name_and_version</strong> (<em>str</em>) – name of network, such as ‘resnet18’</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>tuple of network name, and version</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>{None | (str, {None | int}}</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.nets.NetUtils.net_name_separation_pat">
<span class="sig-name descname"><span class="pre">net_name_separation_pat</span></span><em class="property"> <span class="pre">=</span> <span class="pre">re.compile('([a-zA-Z]*)([0-9]*)$')</span></em><a class="headerlink" href="#birdsong.nets.NetUtils.net_name_separation_pat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.nets.NetUtils.resnet_pattern">
<span class="sig-name descname"><span class="pre">resnet_pattern</span></span><em class="property"> <span class="pre">=</span> <span class="pre">re.compile('resnet([0-9]*)$')</span></em><a class="headerlink" href="#birdsong.nets.NetUtils.resnet_pattern" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.result_tallying">
<span id="birdsong-result-tallying-module"></span><h2>birdsong.result_tallying module<a class="headerlink" href="#module-birdsong.result_tallying" title="Permalink to this headline">¶</a></h2>
<p>Created on Dec 23, 2020</p>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultCollection">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.result_tallying.</span></span><span class="sig-name descname"><span class="pre">ResultCollection</span></span><a class="headerlink" href="#birdsong.result_tallying.ResultCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></p>
<p>Hold an arbitrary number of ResultTally
instances. Services:</p>
<blockquote>
<div><dl class="simple">
<dt>o acts as dict with keys being the step number</dt><dd><p>Step could be an epoch, or one split fold 
constellation having been processed and validated</p>
</dd>
</dl>
<p>o acts as a list as follows:</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultCollection.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_tally_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.result_tallying.ResultCollection.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add new_tally_result instance to this collection:
update the (self)dict with key being the tally’s
step, and value being the tally.</p>
<p>Then update self._sorted_tallies, the
step-sorted list of tallies in this collection</p>
<p>If a tally for the given step and learning
phase already exists, augment the existing
tally with the content of the given arg.</p>
<p>Normally the new result’s step will be contained
in its .step attr. But the step kwarg allows
placing a ResultTally into any step key</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>new_tally_result</strong> (<a class="reference internal" href="#birdsong.result_tallying.ResultTally" title="birdsong.result_tallying.ResultTally"><em>ResultTally</em></a>) – the result to add</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultCollection.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.result_tallying.ResultCollection.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all tallies from this collection</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultCollection.conf_matrix_aggregated">
<span class="sig-name descname"><span class="pre">conf_matrix_aggregated</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.result_tallying.ResultCollection.conf_matrix_aggregated" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultCollection.create_from">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">create_from</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.result_tallying.ResultCollection.create_from" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultCollection.steps">
<span class="sig-name descname"><span class="pre">steps</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.result_tallying.ResultCollection.steps" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a sorted list of steps
that are represented in tallies
within the collection.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultCollection.tallies">
<span class="sig-name descname"><span class="pre">tallies</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newest_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.result_tallying.ResultCollection.tallies" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterator for tallies, optionally filtering by
step and/or phase (training vs. validation)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>step</strong> (<em>int</em>) – step to filter by</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultTally">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.result_tallying.</span></span><span class="sig-name descname"><span class="pre">ResultTally</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_classes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">testing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.result_tallying.ResultTally" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Instances of this class hold results from training,
validating, or testing.</p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.result_tallying.ResultTally.update_tally_metrics">
<span class="sig-name descname"><span class="pre">update_tally_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.result_tallying.ResultTally.update_tally_metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Called from __getattr__(), so don’t retrieve
instance vars; pass them in.
:param labels:
:type labels:
:param preds:
:type preds:</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.rooted_image_dataset">
<span id="birdsong-rooted-image-dataset-module"></span><h2>birdsong.rooted_image_dataset module<a class="headerlink" href="#module-birdsong.rooted_image_dataset" title="Permalink to this headline">¶</a></h2>
<p>The MultiRootImageDataset class supports dataloaders
for images.</p>
<p>The features are similar to torchvision.datasets.ImageFolder
in that the class:</p>
<blockquote>
<div><dl class="simple">
<dt>o Takes pointer(s) into a file tree holding image</dt><dd><p>files of various formats (png, jpg, etc.)</p>
</dd>
<dt>o Assigns integer sample_id numbers to </dt><dd><p>each image file in the tree</p>
</dd>
<dt>o Assigns integer class IDs to each classification</dt><dd><p>target</p>
</dd>
</dl>
<p>o Returns an image tensor when given a sample_id</p>
</div></blockquote>
<p>The class implements a dict-like pytorch dataset.</p>
<p>Like ImageFolder, MultiRootImageDataset expects any one 
subdirectory to contain samples for a single classification
target. The name of the subdirectory must be the name
of the corresponding target.</p>
<p>In contrast to ImageFolder, which requires a single file 
directory root above the class folders, MultiRootImageDataset
accepts multiple roots, merging all samples into a single
dataset. Additionally, root specifications handle ‘~’, as
well as globbed file names:</p>
<blockquote>
<div><p>~/foo/*</p>
</div></blockquote>
<dl>
<dt>NOTE: it is the client’s responsibility to prevent target class</dt><dd><p>name clashes:</p>
<blockquote>
<div><blockquote>
<div><dl class="simple">
<dt>root1</dt><dd><dl class="simple">
<dt>cars</dt><dd><dl class="simple">
<dt>audi</dt><dd><p>audi1.png
audi2.png</p>
</dd>
<dt>bmw</dt><dd><p>bmw1.jpg</p>
</dd>
</dl>
</dd>
<dt>flowers</dt><dd><dl class="simple">
<dt>rose</dt><dd><p>rose1.jpg</p>
</dd>
<dt>tulip</dt><dd><p>tulip1.jpg
tulip2.jpg</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>root 2</dt><dd><dl class="simple">
<dt>cars</dt><dd><p>…</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>will raise a DuplicateTarget exception, because
‘cars’ occurs under multiple roots.</p>
</dd>
</dl>
<p>Instances of the parent class below creates simple bookkeeping 
structures that can easily be extended with additional
targets or sample_ids. This extension is implemented
in the subclass MultiRootImageDataset.</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.MultiRootImageDataset">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.rooted_image_dataset.</span></span><span class="sig-name descname"><span class="pre">MultiRootImageDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">roots</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_grayscale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.MultiRootImageDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#birdsong.rooted_image_dataset.SingleRootImageDataset" title="birdsong.rooted_image_dataset.SingleRootImageDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">birdsong.rooted_image_dataset.SingleRootImageDataset</span></code></a></p>
<p>Combines image samples from multiple directory roots to be combined
into a single dataset. Directory structure assumption
under each of the roots:</p>
<blockquote>
<div><dl>
<dt>root_n:</dt><dd><dl>
<dt>&lt;class1_dir&gt;</dt><dd><p>sample_img1.png
sample_img2.jpg</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
</dd>
<dt>&lt;class1_dir&gt;</dt><dd><p>sample_img1.png
sample_img2.jpg</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>As in roots = [‘/foo/bar/animals’, ‘/foo/bar/cars’]:</dt><dd><dl class="simple">
<dt>/foo/bar/animals</dt><dd><dl class="simple">
<dt>dog</dt><dd><p>dog1.png
dog2.jpg</p>
</dd>
<dt>cat </dt><dd><p>cat1.png
cat2.jpg</p>
</dd>
</dl>
</dd>
<dt>/foo/bar/cars</dt><dd><dl class="simple">
<dt>BMW</dt><dd><p>bmw1.jpg
bmw2.jpg</p>
</dd>
<dt>Audi</dt><dd><p>audi1.jpg
audi2.jpg</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.MultiRootImageDataset.extend_dataset">
<span class="sig-name descname"><span class="pre">extend_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.MultiRootImageDataset.extend_dataset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.rooted_image_dataset.</span></span><span class="sig-name descname"><span class="pre">SingleRootImageDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_grayscale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unittesting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Constructs a pytorch mapping-type dataset
that provides:</p>
<blockquote>
<div><dl class="simple">
<dt>o Recursively finds all target-class directories under</dt><dd><p>a single, given root. Ignores non_image files</p>
</dd>
<dt>o Assumes that the directory names containing</dt><dd><p>images are target class names. This assumption 
matches ImageFolder</p>
</dd>
<dt>o Provides map from sample_ids to absolute file</dt><dd><p>names of corresponding images</p>
</dd>
</dl>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.class_from_sample_id">
<span class="sig-name descname"><span class="pre">class_from_sample_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.class_from_sample_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a sample ID, return its class index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sample_id</strong> (<em>int</em>) – ID to look up</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>given sample’s class ID</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.class_id_list">
<span class="sig-name descname"><span class="pre">class_id_list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.class_id_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list with the integer class ids
between which the classifier is to discriminate.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of integer class labels</p>
</dd>
</dl>
<p>:rtype List(int)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.class_names">
<span class="sig-name descname"><span class="pre">class_names</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.class_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.file_from_sample_id">
<span class="sig-name descname"><span class="pre">file_from_sample_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.file_from_sample_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a sample_id, return the absolute
file path of the corresponding sample
in the file system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sample_id</strong> (<em>int</em>) – sample ID to look up</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.sample_by_idx">
<span class="sig-name descname"><span class="pre">sample_by_idx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx_to_sample</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.sample_by_idx" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve a sample by a list API.
Samples IDs are stored in this dataset 
in a fixed order. The idx_to_sample arg
indexes into this conceptual list, and
retrieves the corresponding sample.</p>
<p>In the implementation, samples are stored as accessed
through ordered dicts by the sample ids.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>idx_to_sample</strong> (<em>int</em>) – index into the conceptual
list of sample ids</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(sample, label) pair</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>(torch.Tensor, torch.Tensor)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.sample_classes">
<span class="sig-name descname"><span class="pre">sample_classes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.sample_classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an np array of class ids
of all samples. The sequence order is
guaranteed to be the same for each call.
Furthermore, the sequence matches that of
the sequence returned from sample_ids()</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Array over all class labels in</p>
</dd>
</dl>
<p>sample_id order.
:rtype: np.array</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.sample_distribution">
<span class="sig-name descname"><span class="pre">sample_distribution</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.sample_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns number of samples for each class
in the dataset</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of tuples: (class_id, num_samples);
one such tuple for each class_id</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>[(int, int)]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.sample_id_by_sample_idx">
<span class="sig-name descname"><span class="pre">sample_id_by_sample_idx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx_to_sample</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.sample_id_by_sample_idx" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve a sample ID by a list API.
Samples IDs are stored in this dataset 
in a fixed order. The idx_to_sample arg
indexes into this conceptual list, and
retrieves the sample ID at that place in
the list.</p>
<p>In the implementation, samples are stored as accessed
through ordered dicts by the sample ids.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>idx_to_sample</strong> (<em>int</em>) – index into the conceptual
list of sample ids</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>sample ID</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.rooted_image_dataset.SingleRootImageDataset.sample_ids">
<span class="sig-name descname"><span class="pre">sample_ids</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.rooted_image_dataset.SingleRootImageDataset.sample_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an iterator over all 
sample IDs. Multiple calls guaranteed
to return IDs in the same order each time</p>
<p>:returns List of sample identifiers
:rtype [int]</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.run_inference">
<span id="birdsong-run-inference-module"></span><h2>birdsong.run_inference module<a class="headerlink" href="#module-birdsong.run_inference" title="Permalink to this headline">¶</a></h2>
<p>Created on Mar 12, 2021</p>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.run_inference.Inferencer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.run_inference.</span></span><span class="sig-name descname"><span class="pre">Inferencer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gpu_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.run_inference.Inferencer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>classdocs</p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.run_inference.Inferencer.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.run_inference.Inferencer.close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.run_inference.Inferencer.go">
<span class="sig-name descname"><span class="pre">go</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.run_inference.Inferencer.go" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.run_inference.Inferencer.prep_model_inference">
<span class="sig-name descname"><span class="pre">prep_model_inference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.run_inference.Inferencer.prep_model_inference" title="Permalink to this definition">¶</a></dt>
<dd><ol class="arabic">
<li><dl class="simple">
<dt>Parses model_path into its components, and </dt><dd><p>creates a dict: self.model_props, which 
contains the network type, grayscale or not,
whether pretrained, etc.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Creates self.csv_writer to write results measures</dt><dd><p>into csv files. The destination file is determined
as follows:</p>
<blockquote>
<div><p>&lt;script_dir&gt;/runs_raw_inferences/inf_csv_results_&lt;datetime&gt;/&lt;model-props-derived-fname&gt;.csv</p>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Creates self.writer(), a tensorboard writer with destination dir:</dt><dd><p>&lt;script_dir&gt;/runs_inferences/inf_results_&lt;datetime&gt;</p>
</dd>
</dl>
</li>
<li><p>Creates an ImageFolder classed dataset to self.samples_path</p></li>
<li><p>Creates a shuffling DataLoader</p></li>
<li><p>Initializes self.num_classes and self.class_names</p></li>
<li><p>Creates self.model from the passed-in model_path name</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>model_path</strong> (<em>str</em>) – path to model that will be used for
inference by this instance of Inferencer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.run_inference.Inferencer.report_results">
<span class="sig-name descname"><span class="pre">report_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tally_coll</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.run_inference.Inferencer.report_results" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.run_inference.Inferencer.run_inference">
<span class="sig-name descname"><span class="pre">run_inference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gpu_to_use</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.run_inference.Inferencer.run_inference" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs model over dataloader. Along
the way: creates ResultTally for each
batch, and maintains dict instance variable
self.raw_results for later conversion of
logits to class IDs under different threshold
assumptions.</p>
<dl class="simple">
<dt>self.raw_results: </dt><dd><dl class="simple">
<dt>{‘all_outputs’<span class="classifier">&lt;arr&gt;,</span></dt><dd><p>‘all_labels’  : &lt;arr&gt;
}</p>
</dd>
</dl>
</dd>
</dl>
<p>Returns a ResultCollection with the
ResultTally instances of each batch.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>gpu_to_use</strong> (<em>int</em>) – which GPU to deploy to (if it is available)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>collection of tallies, one for each batch,
or None if something went wrong.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>{None | ResultCollection}</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.samplers">
<span id="birdsong-samplers-module"></span><h2>birdsong.samplers module<a class="headerlink" href="#module-birdsong.samplers" title="Permalink to this headline">¶</a></h2>
<p>Created on Dec 17, 2020</p>
<p>&#64;author: paepcke</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.samplers.DistributedSKFSampler">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.samplers.</span></span><span class="sig-name descname"><span class="pre">DistributedSKFSampler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_last</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.samplers.DistributedSKFSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#birdsong.samplers.SKFSampler" title="birdsong.samplers.SKFSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">birdsong.samplers.SKFSampler</span></code></a></p>
<p>Like SKFSampler, but can operate in a
distributed environment, where samples 
are process in different machines and/or
GPUs.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.samplers.SKFSampler">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.samplers.</span></span><span class="sig-name descname"><span class="pre">SKFSampler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_last</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.samplers.SKFSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.model_selection._split.StratifiedKFold</span></code></p>
<p>This is an abstract class, i.e. it cannot
be instantiated directly. Use the DistributedSKFSampler
class.</p>
<p>Partitions dataset into num_folds
sequences of batches. Manages serving
batches one train fold at a time. Switch
between train folds is transparent.</p>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.samplers.SKFSampler.compute_effective_total_size">
<span class="sig-name descname"><span class="pre">compute_effective_total_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.samplers.SKFSampler.compute_effective_total_size" title="Permalink to this definition">¶</a></dt>
<dd><p>There may be multiple processes (replicas)
of the training script running. These might
each work on the entire dataset, or just on
their unique subset.</p>
<p>The subsets should be disjoint, so the entire
dataset is covered, but no sample is used
by more than one replica.</p>
<p>Whether or not multiple replicas exist is 
indicated by world_size.</p>
<p>If the dataset length is evenly divisible by # of 
replicas, then there is no need to drop any data, 
since the dataset will be split equally. Otherwise,
depending on whether drop_last was requested, 
an adjustment is made to exclude the pieces of data
that do not fill a fold.</p>
<p>That adjustement in turn will make the effective
total number of samples across all machines and processes
slightly different from the number of samples in the
dataset. Compute that effective size, and initialize
self.total_size.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.samplers.SKFSampler.generate_folds">
<span class="sig-name descname"><span class="pre">generate_folds</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.samplers.SKFSampler.generate_folds" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new fold_generator. Called
by the top level training script via
calling set_epoch() on its dataloader</p>
<p>This method must be called at the start
of each  new epoch (except for epoch 0, which 
is taken care of in the constructor).
Do not call this method during the course
of an epoch, else samples may be reused
in unpredictable sequences.</p>
<p>Creates a new split, after optionally 
shuffling the underlying dataset. No
shuffling occurs after that.</p>
<p>The shuffle is predictable based on 
the seed and the epoch. All replicas
therefore shuffle the same way.</p>
<p>Sets self.fold_generator.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.samplers.SKFSampler.get_split">
<span class="sig-name descname"><span class="pre">get_split</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.samplers.SKFSampler.get_split" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.samplers.SKFSampler.set_epoch">
<span class="sig-name descname"><span class="pre">set_epoch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_epoch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.samplers.SKFSampler.set_epoch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.trainingOrig">
<span id="birdsong-trainingorig-module"></span><h2>birdsong.trainingOrig module<a class="headerlink" href="#module-birdsong.trainingOrig" title="Permalink to this headline">¶</a></h2>
<p>Trains a single instance of the model and saves the training results to a .jsonl file.</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.trainingOrig.ImageFolderWithPaths">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.trainingOrig.</span></span><span class="sig-name descname"><span class="pre">ImageFolderWithPaths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">root</span></em>, <em class="sig-param"><span class="pre">transform=None</span></em>, <em class="sig-param"><span class="pre">target_transform=None</span></em>, <em class="sig-param"><span class="pre">loader=&lt;function</span> <span class="pre">default_loader&gt;</span></em>, <em class="sig-param"><span class="pre">is_valid_file=None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.ImageFolderWithPaths" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.utils.data.dataset.T_co</span></code>]</p>
<p>Custom dataset that includes image file paths. Extends
torchvision.datasets.ImageFolder</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>root</strong> (<em>method</em>) – the filepath of a folder containing the images.</p></li>
<li><p><strong>root</strong> – A transformation to perform on each image.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.trainingOrig.Training">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.trainingOrig.</span></span><span class="sig-name descname"><span class="pre">Training</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">net_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'BasicNet'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.Training" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Creates and instance of the model and can train that model with specified parameter and log the results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<em>str</em>) – the parent directory of the labelled samples.</p></li>
<li><p><strong>epochs</strong> (<em>int</em>) – the max number of epochs to train each model for.</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – a value used to define the batch size of each layer.</p></li>
<li><p><strong>kernel_size</strong> (<em>int</em>) – a value the defines the kernel size of the convolutional layers.</p></li>
<li><p><strong>seed</strong> (<em>int</em>) – the integer seed for training the model.</p></li>
<li><p><strong>net_name</strong> (<em>str</em>) – the name of the type of model to use</p></li>
<li><p><strong>gpu</strong> (<em>int</em>) – which GPU to use. The CPU is used if gpu=None.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.trainingOrig.Training.cf_matrix">
<span class="sig-name descname"><span class="pre">cf_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_loader</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.Training.cf_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs preliminary data analysis of the testing DataLoader.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data_loader</strong> (<em>DataLoader</em>) – the test_data_loader to gather information from</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a confusion matrix, precision and recall values, and the paths of misclassified samples</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.trainingOrig.Training.configure_log">
<span class="sig-name descname"><span class="pre">configure_log</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.Training.configure_log" title="Permalink to this definition">¶</a></dt>
<dd><p>Configures a .jsonl file with the correct column headers.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.trainingOrig.Training.get_net">
<span class="sig-name descname"><span class="pre">get_net</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gpu</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.Training.get_net" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and returns an instance of a specified model</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>net_name</strong> (<em>str</em>) – the name of the type of model to use</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – An int used to define the batch size of each layer.</p></li>
<li><p><strong>kernel_size</strong> (<em>int</em>) – An int the defines the kernel size of the convolutional layers.</p></li>
<li><p><strong>gpu</strong> (<em>int</em>) – Which GPU to use. The CPU is used if gpu=None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.trainingOrig.Training.import_data">
<span class="sig-name descname"><span class="pre">import_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.Training.import_data" title="Permalink to this definition">¶</a></dt>
<dd><p>imports the spectrograms using DataLoaders and transforms each image into a tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a DataLoader containing the training data</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.trainingOrig.Training.set_seed">
<span class="sig-name descname"><span class="pre">set_seed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.Training.set_seed" title="Permalink to this definition">¶</a></dt>
<dd><p>set the seed for the model to allow for comparison of different models.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>seed</strong> (<em>int</em>) – the integer seed for training the model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.trainingOrig.Training.test">
<span class="sig-name descname"><span class="pre">test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_loader</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.Training.test" title="Permalink to this definition">¶</a></dt>
<dd><p>calculates the percent accuracy of information in a DataLaoder.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data_loader</strong> (<em>DataLoader</em>) – the DataLoader to examine</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the percent accuracy of data_loader</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.trainingOrig.Training.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.trainingOrig.Training.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Trains the model until the accuracy plateaus or the maximum
number of epochs to train has been reached. Logs the results of the training after each epoch.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong.xeno_canto_manager">
<span id="birdsong-xeno-canto-manager-module"></span><h2>birdsong.xeno_canto_manager module<a class="headerlink" href="#module-birdsong.xeno_canto_manager" title="Permalink to this headline">¶</a></h2>
<p>Functions involved in downloading birds from xeno-canto
Can be used from the command line (see argparse entries
at end of file). Or one can import XenoCantoCollection
and XenoCantoRecording into an application.</p>
<p>Two classes:</p>
<blockquote>
<div><dl class="simple">
<dt>o XenoCantoRecording to hold metadata about available XC</dt><dd><p>sound files</p>
</dd>
</dl>
<p>o XenoCantoCollection to hold XenoCantoRecording instances</p>
</div></blockquote>
<p>A XenoCantoCollection instance acts like a dict whose keys are
concatenations of genus and species names, e.g. ‘Tangaragyrola’
Each value in the dict is a <em>list</em> of XenoCantoRecording instances 
for that type of bird.</p>
<p>So the keys of a XenoCantoCollection instance might look like:</p>
<p>{‘Tangaragyrola’ : [rec1, rec2, rec3]
 ‘Amaziliadecora’: [rec4, rec5]
}</p>
<p>A XenoCantoRecording also behaves like a dict:</p>
<p>Keys are:
        genus
        species
        phylo_name       # ‘Tangaragyrola’
        full_name        # Unique name like ‘Tangaragyrola_xc3562156’ 
        country
        loc              # Name of park/city/preserve 
        recording_date
        length
        encoding         # [‘mpeg’, ‘wav.vpn’]
        type             # [‘call’, ‘song’]</p>
<p>        _xeno_canto_id
        _filename (if downloaded)
        _url</p>
<p>A XenoCantoCollection instance can also act as an iterator:</p>
<blockquote>
<div><p>for recording in my_coll(one_per_bird_phylo=True):
    print(recording.full_name)</p>
</div></blockquote>
<p>The one_per_bird_phylo kwarg controls whether
only one of each species’ recordings are included
in the iteration, or whether the list of all recordings 
for all species are served out.</p>
<p>The interaction model is to pull metadata for each
desired species by running this script from the command
line either with or without downloading the actual sound 
files. That process creates a XenoCantoCollection, which
is saved to disk as a pickle.</p>
<p>One can ask the XenoCantoCollection instance to
download some or all recordings. Individual XenoCantoRecording
instances also know how to download.</p>
<p>Working with the collection:</p>
<p>Clients can import the module, rather than calling
from the command line. The resource can therefore
be integrated into a workflow.</p>
<p>After the sound files are downloaded, the following
is a template for use without re-contacting the Xeno Canto
server:</p>
<p>from birdsong.xeno_canto_manager import XenoCantoCollection, XenoCantoRecording
sound_collection = XenoCantoCollection.load(‘&lt;path to pickled collection’)</p>
<p># The following iterates through
# XenoCantoRecording instances, <em>one</em>
# recording of each species:</p>
<dl class="simple">
<dt>for recording in sound_collection:</dt><dd><p>print(recording.full_name)
print(recording.filepath)</p>
</dd>
</dl>
<p># The same, but all recordings of
# every species:</p>
<dl class="simple">
<dt>for recording in sound_collection(one_per_bird_phylo=False):</dt><dd><p>print(recording.full_name)
print(recording.filepath)</p>
</dd>
</dl>
<p># TODO:
#   o Example for getting metadata</p>
<dl class="py class">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.xeno_canto_manager.</span></span><span class="sig-name descname"><span class="pre">XenoCantoCollection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bird_names_or_coll_path</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Holds information about multiple Xeno Canto
recordings. Each holding is a XenoCantoRecordingO
instance, keyed by species name. For each species
may hold multiple recording instances.</p>
<p>Constructor takes a raw download from Xeno Canto
(see xeno_canto_get_bird_metadata()). Downloads are
of the form:</p>
<blockquote>
<div><dl>
<dt>{&lt;download metadata: num recordings, num species,…</dt><dd><dl>
<dt>“recordings”<span class="classifier">[{recording metadata: recording date,</span></dt><dd><blockquote>
<div><blockquote>
<div><p>species name,
download info,
…</p>
</div></blockquote>
<p>},
{next recording metadata},
…</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.all_recordings">
<span class="sig-name descname"><span class="pre">all_recordings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.all_recordings" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience method: returns a list
of all XenoCantoRecording instances
in this collection. I.e. not separated
by species, just all recordings from all
species appended together</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.create_filename">
<span class="sig-name descname"><span class="pre">create_filename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dest_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extension</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.json'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.create_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a file name that is not in the 
given directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dest_dir</strong> – </p>
</dd>
</dl>
<p>:return filename 
:rtype str</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.download">
<span class="sig-name descname"><span class="pre">download</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">birds_to_process</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">one_per_species</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">courtesy_delay</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.download" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a given list of species, or
all the species in the collection.</p>
<p>If one_per_species is True, only one recording
from the list of each species’ recordings is
downloaded; else all recordings of each requested
species.</p>
<p>Courtesy delay is time to wait between sound file
downloads.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>birds_to_process</strong> (<em>[</em><em>str</em><em>]</em>) – list of bird species names</p></li>
<li><p><strong>one_per_species</strong> (<em>bool</em>) – whether or not to download all 
recordings of each species, or just one</p></li>
<li><p><strong>courtesy_delay</strong> (<em>{int | float}</em>) – time between requests to XC server</p></li>
<li><p><strong>overwrite_existing</strong> (<em>bool</em>) – if True, already existing 
sound files will be overwritten without asking.
If False, always ask once, then use answer as 
default going forward. If None: same as False.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.from_json">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">from_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.from_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a collection either from a JSON string,
or from a file that contains JSON.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>src</strong> (<em>str</em>) – either a json string to parse,
or the path to a file ending with
either .json or .JSON</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the loaded collection</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#birdsong.xeno_canto_manager.XenoCantoCollection" title="birdsong.xeno_canto_manager.XenoCantoCollection">XenoCantoCollection</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.instantiate_recs">
<span class="sig-name descname"><span class="pre">instantiate_recs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bird_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.instantiate_recs" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of bird species, download
each bird’s metadata. Then create a
XenoCantoRecording instance for each
recording. Don’t download the recordings
themselves.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>bird_names</strong> (<em>[</em><em>str</em><em>]</em>) – list of species as needed
to download from the Xeno Canto server</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.items">
<span class="sig-name descname"><span class="pre">items</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.items" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.keys">
<span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.keys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.len_all">
<span class="sig-name descname"><span class="pre">len_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.len_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.load">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes path to either a .json or 
a .pkl (or .pickle) file. Materializes
the XenoCantoCollection that is
encoded in the file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>src</strong> (<em>str</em>) – full path to pickle or json file
of previously saved collection</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.num_recordings">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">num_recordings</span></span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.num_recordings" title="Permalink to this definition">¶</a></dt>
<dd><p>Lazily evaluated num_recordings property.
The quantity is the number of all recordings
in this collection instance’s values(). If
those values are themselves collections, add
up their number of recordings.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.one_per_bird_phylo">
<span class="sig-name descname"><span class="pre">one_per_bird_phylo</span></span><em class="property"> <span class="pre">=</span> <span class="pre">True</span></em><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.one_per_bird_phylo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves collection to given file. Only the
metadata for the collection itself, and
the enclosed XenoCantoRecording instances
are saved, not the soundfiles themselves.
They are normally in their own dir, with 
the XenoCantoRecording instances holding
the file paths.</p>
<p>If dest:</p>
<blockquote>
<div><dl>
<dt>o is an existing directory, a .json file name </dt><dd><p>is created for the collection
file.</p>
</dd>
<dt>o is a file name as ascertained by the</dt><dd><blockquote>
<div><p>presence of an extension: 
If the dest file ends with ‘.json’ 
the output format is JSON. If it 
ends with ‘.pkl’ or ‘.pickle’ the 
sound_collection is saved in pickle format.
Any other extension is an error.</p>
</div></blockquote>
<dl class="simple">
<dt>o Is None: the destination directory</dt><dd><p>will be a subdir ‘xeno_canto_collections’
under this script’s dir.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>In all cases, non-existing directories
will be created.</p>
<dl class="simple">
<dt>Note: Pickle is fast to load, but very finicky </dt><dd><p>about file names and directory structures
being exactly what they were at saving
time. So JSON is recommended.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dest</strong> (<em>str</em>) – <p>destination directory or
file path for the saved collection. 
Default:</p>
<blockquote>
<div><p>&lt;dir_of_this_script&gt;/xeno_canto_collections</p>
</div></blockquote>
</p>
</dd>
</dl>
<p>:return the full path of the output file
:rtype str</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.to_json">
<span class="sig-name descname"><span class="pre">to_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.to_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a JSON string from this 
collection. If dest is a string,
it is assumed to be a destination
file where the json will be saved.
If none, the generated JSON string 
is returned. It can be passed to 
from_json() in the json_str
kwarg.</p>
<p>If the file exists, the user is warned,
unless force is True.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dest</strong> (<em>{None | str}</em>) – optional destination file</p></li>
<li><p><strong>force</strong> (<em>bool</em>) – set to True if OK to overwrite
dest file. Default: ask permission</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>:return destination file name if written to</dt><dd><p>file, else the JSON string</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.values">
<span class="sig-name descname"><span class="pre">values</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.values" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoCollection.xeno_canto_get_bird_metadata">
<span class="sig-name descname"><span class="pre">xeno_canto_get_bird_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bird_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoCollection.xeno_canto_get_bird_metadata" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoRecording">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">birdsong.xeno_canto_manager.</span></span><span class="sig-name descname"><span class="pre">XenoCantoRecording</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recording_metadata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dest_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoRecording" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoRecording.always_overwrite">
<span class="sig-name descname"><span class="pre">always_overwrite</span></span><em class="property"> <span class="pre">=</span> <span class="pre">None</span></em><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoRecording.always_overwrite" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoRecording.default_dest_dir">
<span class="sig-name descname"><span class="pre">default_dest_dir</span></span><em class="property"> <span class="pre">=</span> <span class="pre">None</span></em><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoRecording.default_dest_dir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoRecording.download">
<span class="sig-name descname"><span class="pre">download</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dest_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">testing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoRecording.download" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoRecording.from_dict">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">from_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inst_var_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoRecording.from_dict" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoRecording.from_json">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">from_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">json_str_or_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoRecording.from_json" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="birdsong.xeno_canto_manager.XenoCantoRecording.to_json">
<span class="sig-name descname"><span class="pre">to_json</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#birdsong.xeno_canto_manager.XenoCantoRecording.to_json" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-birdsong">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-birdsong" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>